<!--

    Copyright © 2012 ecuacion.jp (info@ecuacion.jp)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
</head>
<body>

	<!--/* 
		###
		### base-page components (components available in any pages)
		###
	 */-->
	 
	<!--/* 
		### common components
	 */-->
	 
	<!--/* allComponentsExternalFrame */-->
	<!--/* parameters:
		- createsComponentIdDiv:	If it's true, <div th:id="${componentId}"> is created. 
		  If it's false (=you don't want to add 'id' attribute to div component), caller component need to implement component as id = ${componentId}. 
	 */-->
	<!--/* options:
		- componentId	string	Specifies 'id' attribute of the whole integrated component. 
								As default id value is the same as the value of name for html controls.
		- mt			integer	Specifies the margin top value of the integrated component. 
								When you set 'mt=3' to options, it turns into 'class="mt-3"'. It's valid only when createsComponentIdDiv == true.
		- mb			integer Specifies the margin bottom value of the integrated component.
								When you set 'mb=3' to options, it turns into 'class="mb-3"'. It's valid only when createsComponentIdDiv == true.
 	 */-->
	<div th:fragment="internalAllCommonComponent(contentsOfAllCommon, createsComponentIdDiv, options)" th:remove="tag">
		<th:block th:with="componentId=${@optUtil.getValueOrElse(options, 'componentId', null)},
				mtClass=${@optUtil.hasKey(options, 'mt') ? 'mt-' + @optUtil.getValue(options, 'mt') : ''},
				mbClass=${@optUtil.hasKey(options, 'mb') ? 'mb-' + @optUtil.getValue(options, 'mb') : ''},
				">
			<div th:if="${createsComponentIdDiv}" th:id="${componentId}" th:classappend="${mtClass} + ' ' + ${mbClass}">
				<th:block th:replace="${contentsOfAllCommon}" />
			</div>
			<th:block th:if="${!createsComponentIdDiv}">
				<th:block th:replace="${contentsOfAllCommon}" />
			</th:block>
		</th:block>
	</div>
	
	<!--/* fragment with no contents. Used as 'null' fragment since you can't pass null to fragment parameters. */-->
	<div th:fragment="fragmentNoContents" th:remove="tag">
	</div>

	<!--/* 
		### message components
	 */-->

	<!--/* internal common display message component */-->
	<!--/* 
		'title' and 'message' can be the key to the message.properties or item_names.properties, 
		or if it does not exist in properties files, it shows the string directly.
	*/-->
	<!--/* options:
		- selectable	boolean	Specifies whether it looks selectable on hover. Notice that this option make components look like selectable only.
						Procedure on click needs to be added aside this option.
						This options is meant to be a message components common option, but for now it's implemented only in speechBaloon.
 	 */-->
 	<div th:fragment="internalMessageCommonComponent(contents, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentMessageCommonComponent}, true, ${options})}"></div>
 		
		<th:block th:if="false"><div th:fragment="fragmentMessageCommonComponent" th:remove="tag">
			<div class="text-dark" 
					th:with="titleString=${@msgUtil.get(#locale, title)},
					messageString=${@msgUtil.get(#locale, message)},
					isSelectable=${@optUtil.hasKey(options, 'selectable')}">

				<th:block th:replace="${contents}" />

			</div>
		</div>
	</div>

	<!--/* title */-->
	<div th:fragment="title(title, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: titleInternal}, ${'mt=3,mb=5,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="titleInternal" th:remove="tag">
			<div class="fs-3 fw-bold" th:text="${titleString}"></div>
		</div></th:block>
	</div>

	<!--/* titleDesc */-->
	<!--/* It's placed above the message space, so it does not seem very useful. Maybe it will become deprecated in the future. */-->
	<div th:fragment="titleDesc(message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: titleDescInternal}, ${'mb=5,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="titleDescInternal" th:remove="tag">
			<th:block th:if="${!#strings.isEmpty(messageString)}">
				<div class="" style="white-space: pre-wrap;" th:text="${messageString}"></div>
			</th:block>
		</div></th:block>
	</div>

	<!--/* subtitle  */-->
	<div th:fragment="subtitle(title, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: subtitleInternal}, ${'mt=5,mb=3,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="subtitleInternal" th:remove="tag">
			<div class="border-5 border-color-subtitle fs-5 fw-bold pt-1 pb-1 ps-3" style="border-left: solid;" th:text="${titleString}"></div>
		</div></th:block>
	</div>

	<!--/* paragraphWithSubtitle */-->
	<div th:fragment="paragraphWithSubtitle(title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: paragraphWithSubtitleInternal}, ${'mt=5,mb=3,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphWithSubtitleInternal" th:remove="tag">
 			<div th:replace="~{ :: subtitleInternal}"></div>
			<div class="mt-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* subsubtitle  */-->
	<div th:fragment="subsubtitle(title, options)" th:remove="tag">
		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: subsubtitleInternal}, ${'mt=5,mb=3,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="subsubtitleInternal" th:remove="tag">
			<div>
				<div class="pt-1 pb-1 ps-3">
					<span class="text-color-subtitle me-3 fs-7 fw-bold">&#45;</span><span class="fs-5 fw-bold" th:text="${titleString}"></span>
				</div>
			</div>
		</div></th:block>
	</div>

	<!--/* paragraphWithSubsubtitle */-->
	<div th:fragment="paragraphWithSubsubtitle(title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: paragraphWithSubsubtitleInternal}, ${'mb=3,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphWithSubsubtitleInternal" th:remove="tag">
 			<div th:replace="~{ :: subsubtitleInternal}"></div>
			<div class="mt-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* paragraph */-->
	<div th:fragment="paragraph(message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: paragraphInternal}, ${'mt=3,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphInternal" th:remove="tag">
			<div class="" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* referenceBox */-->
	<div th:fragment="referenceBox(title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: referenceBoxInternal}, ${'mt=4,' + options})}"></div>

		<th:block th:if="false"><div th:fragment="referenceBoxInternal" th:remove="tag">
			<th:block th:if="${!#strings.isEmpty(titleString)}"><code class="text-dark" th:text="'[' + ${titleString} + ']'"></code></th:block>
			<div class="border ps-3 pe-3" style="background-color: #ffffe0">
				<pre class="mb-0"><code><div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div></code></pre>
			</div>
		</div></th:block>
	</div>

	<!--/* box. space enclosed by a frame. */-->
	<div th:fragment="box(boxContents, title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: boxInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="boxInternal" th:remove="tag">
			<div class="border mt-3">
				<div class="m-3">
					<th:block th:if="${!#strings.isEmpty(titleString)}">
						<div class="fs-4 mb-3" th:text="${titleString}"></div>
					</th:block>
					<th:block th:if="${!#strings.isEmpty(messageString)}">
						<div class="mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
					</th:block>

					<th:block th:replace="${boxContents}" />

				</div>
			</div>
		</div></th:block>
	</div>
	
	<!--/* freeSpace */-->
	<!--/* You can input free text / html. It is used for commonize color and font. */-->
	<div th:fragment="freeSpace(freeSpaceContent, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: freeSpaceInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="freeSpaceInternal" th:remove="tag">
				<th:block th:replace="${freeSpaceContent}" />
		</div></th:block>
	</div>
	
	<!--/* speech balloon: chat style message component. */-->
	<!--/* 
		special thanks to: https://stand-4u.com/css/fukidashi.html
	 */-->
	<div  th:fragment="speechBalloon(message, isMyMessage, name, timestamp, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageCommonComponent(~{ :: fragmentSpeechBalloon}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSpeechBalloon" th:remove="tag">
			<!--/* Add space character when the input string is blank. */-->
			<div th:classappend="'balloon_' + ${isMyMessage ? 'r' : 'l'}" th:with="message=${message == null || message == '' ? '&nbsp;' : message}">
				<div class="faceicon" th:if="${!isMyMessage}">
					<img th:src="@{/images/speech-balloon-account-icon.png}" alt="" />
				</div>
				<div>
					<div class="name" th:if="${!isMyMessage}" th:text="${name}"></div>
					<div th:classappend="${'says' + (isSelectable ? '-selectable' : '')}" th:text="${messageString}"></div>
					<div class="name mt-1" th:style="${'font-size: 60%; ' + (isMyMessage ? '' : 'display: flex; align-items: flex-end;')}">
					<span th:style="${isMyMessage ? 'margin-left: auto;' : ''}" th:text="${timestamp}"></span>
				</div>
			</div>
		</div></th:block>
	</div>
	
	<!--/* 
		### table components.
	 */-->

	<!--/* internal common table component */-->
	<!--/* 
		'title' and 'message' can be the key to the message.properties or item_names.properties, 
		or if it does not exist in properties files, it shows the string directly.
	*/-->
	<div th:fragment="internalTableCommonComponent(contents, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentTableCommonComponent}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentTableCommonComponent" th:remove="tag">
			<th:block th:replace="${contents}" />
		</div></th:block>
	</div>

	<!--/* internalStaticTableCell */-->
	<!--/* parameters:
		- cellElement		multiple types	an array which consists of attributes of a cell. The array can be one of the following formats:
											1. string                   (just a string)
											2. ${ {string} }            (an array with one attribute)
											3. ${ {string, options} }   (an array with two attributes)
		- isHeader			boolean			Specifies whether the cell is placed in the header line or not.
		- cascadedOptions	string			options set for line or the head / body part of the table.
											The options for cell is prior to it, but when the value is not set at the option for cell, 
											the value of cascadedOptions is used.
	 */-->
	<!--/* options: (in the cellELement)
		- rowspan			integer	Specifies the rowspan value. default value is 1.
		- colspan			integer	Specifies the colspan value. default value is 1.
		- textAlignment		string	Specifies the text-alignment. It takes either start, end, center.
		- textColor			string	Specifies the color attribute.
		- backgroundColor	string	Specifies the background-color attribute.
 	 */-->
	<div th:fragment="internalStaticTableCell(cellElement, isHeader, cascadedOptions)" th:remove="tag">
		<th:block th:with="
				string=${cellElement.class.name == 'java.lang.String' ? cellElement : cellElement[0]},
				options=${cascadedOptions + ',' + ((cellElement.class.name == 'java.lang.String' || #lists.size(cellElement)== 1) ? '' : cellElement[1])}">
			<th:block th:with="
					textColor=${@optUtil.getValueOrElse(options, 'textColor', '')},
					textColorStyle=${textColor == '' ? '' : 'color: ' + textColor + '; '},
					bgColor=${@optUtil.getValueOrElse(options, 'backgroundColor', '')},
					bgColorStyle=${bgColor == '' ? '' : 'background-color: ' + bgColor + '; '},
					class=${'align-middle fs-6'},
					text=${@msgUtil.get(#locale, string)},
					textAlignment=${'text-' + @optUtil.getValueOrElse(options, 'textAlignment', isHeader ? 'center' : 'left')},
					style=${'white-space: pre-wrap; ' + textColorStyle + bgColorStyle},
					rowspan=${@optUtil.getValueOrElse(options, 'rowspan', 1)},
					colspan=${@optUtil.getValueOrElse(options, 'colspan', 1)},
					">

				<th:block th:if="${isHeader}">
					<th th:class="${class + ' text-white bg-color-tbl-header bg-gradient'}" th:classappend="${textAlignment}" th:text="${text}"	th:style="${style}" th:rowspan="${rowspan}" th:colspan="${colspan}"></th>
				</th:block>
				
				<th:block th:if="${!isHeader}">
					<td th:class="${class}" th:classappend="${textAlignment}" th:text="${text}"	th:style="${style}"	th:rowspan="${rowspan}" th:colspan="${colspan}"></td>
				</th:block>
			</th:block>
		</th:block>
	</div>

	<!--/* internalStaticTableLine */-->
	<!--/* parameters:
		- cellElements		array	an array of "cellElement"s. See parameters part of "internalStaticTableCell" for the format of each cellElement.
									The array can be { cellElement, ..., } or { cellElement, ..., lineOptions }.
									"lineOptions" is a format of the same as that of cellElement, { null, options }. 1st element must be null.
									lineOptions is a string parameter, which is cascaded to cellElement options.		
		- cascadedOptions	string	options cascaded from the upper component.
	 */-->
 	<div th:fragment="internalStaticTableLine(cellElementsFor1Line, isHeader, cascadedOptions)" th:remove="tag">
		<th:block th:with="arrayLength=${#lists.size(cellElementsFor1Line)}, 
				containsOptionsInLine=${cellElementsFor1Line[arrayLength - 1].class.name.contains('Collection') and cellElementsFor1Line[arrayLength - 1][0] == null}, 
				optionsInLine=${containsOptionsInLine ? cellElementsFor1Line[arrayLength - 1][1] : ''}, options=${cascadedOptions + ',' + optionsInLine}">
			<th:block th:with="arrayLength=${containsOptionsInLine ? arrayLength - 1 : arrayLength}">
				<tr>
					<th:block th:each="cellElement, loopStatus : ${cellElementsFor1Line}">
						<th:block th:if="${loopStatus.index < arrayLength}">
							<div th:replace="~{ :: internalStaticTableCell(${cellElement}, ${isHeader}, ${cascadedOptions + ',' + options})}"></div>
						</th:block>
					</th:block>
				</tr>
			</th:block>
		</th:block>
	</div>
		
	<!--/* static table lines from lines of cell elements */-->
	<div th:fragment="internalStaticTableLines(lines, isHeader, cascadedOptions)" th:remove="tag">
		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentinternalStaticTableLines}, ${cascadedOptions})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentinternalStaticTableLines" th:remove="tag">
			<th:block th:with="containsOptionsInLines=${lines[#lists.size(lines) - 1].class.name.contains('String')}, 
					optionsInLines=${containsOptionsInLines ? lines[#lists.size(lines) - 1] : ''}, options=${cascadedOptions + ',' + optionsInLines}">
				<th:block th:each="cellElementsFor1Line, loopStatus : ${lines}">
					<th:block th:if="${!containsOptionsInLines or loopStatus.index != #lists.size(lines) - 1}">
						<div th:replace="~{ :: internalStaticTableLine(${cellElementsFor1Line}, ${isHeader}, ${options})}"></div>
					</th:block>
				</th:block>
			</th:block>
		</div></th:block>
	</div>
	
	<!--/* static table header */-->
	<!--/* 
		The parameter labels is an array of strings.
		It's supposed to define as "${ {'messageId_1', 'messageId_2', 'messageId_3'} }".
	 */-->
	<div th:fragment="staticTableHeaderWithLine(cellElements, options)" th:remove="tag">
 		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentStaticTableHeaderWithLine}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentStaticTableHeaderWithLine" th:remove="tag">
			<thead th:id="${componentId}">
				<div th:replace="~{ :: internalStaticTableLine(${cellElements}, true, ${options})}"></div>
			</thead>
		</div></th:block>
	</div>
	
	<div th:fragment="staticTableHeaderWithLines(headerLines, options)" th:remove="tag">
 		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentStaticTableHeaderWithLines}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentStaticTableHeaderWithLines" th:remove="tag">
			<thead th:id="${componentId}">
				<div th:replace="~{ :: internalStaticTableLines(${headerLines}, true, ${options})}"></div>
			</thead>
		</div></th:block>
	</div>
	<!--/* static table body from lines of cell elements. */-->
	<!--/*
		Each cellElement in a table is expressed in the form of an array :  {alignment, string} or {alignment, string, rowspan, colspan}
		where alignment selections are 'start', 'center' and 'end'.
		cellElements (= cell elements which form a line of a table) is an array of 'cellElement's, which means cellElements is a 2-dimensional array.
		linesOfCellElements is an array of cellElements, which means linesOfCellElements is 3-dimensional array.
	 */-->
	<div th:fragment="staticTableBodyWithLines(linesOfCellElements, options)" th:remove="tag">
		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentstaticTableBodyWithLines}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentstaticTableBodyWithLines" th:remove="tag">
			<tbody th:id="${componentId}">
				<div th:replace="~{ :: internalStaticTableLines(${linesOfCellElements}, false, ${options})}"></div>
			</tbody>
		</div></th:block>
 	</div>
	
	<!--/* static table body from an array of lines of cell elements. */-->
	<!--/* 
		staticTableBodyWithLines creates table from one 'linesOCellElements', 
		but sometimes you want to create a table from multiple 'linesOfCellElements', 
		for example table lines have a common part. 
	 */-->
	<div th:fragment="staticTableBodyWithArrayOfLines(arrayOfLinesOfCellElements, options)" th:remove="tag">
		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentStaticTableBodyWithArrayOfLines}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentStaticTableBodyWithArrayOfLines" th:remove="tag">
			<tbody th:id="${componentId}">
				<th:block th:each="linesOfCellElements : ${arrayOfLinesOfCellElements}">
					<div th:replace="~{ :: internalStaticTableLines(${linesOfCellElements}, false, ${options})}"></div>
				</th:block>
			</tbody>
		</div></th:block>
 	</div>

	<!--/* 
		### shape components.
	 */-->
	
	<!--/* hr */-->
	<div th:fragment=horizontalLine(options) th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentHorizontalLine}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentHorizontalLine" th:remove="tag">
			<hr class="mt-4 mb-4">
		</div></th:block>
	</div>

	<!--/* 
		### navbar components.
	 */-->
	
	<!--/* internal common navBar component */-->
	<div th:fragment="internalNavbarCommonComponent(contents, label, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentNavbarCommonComponent}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavbarCommonComponent" th:remove="tag">
			<th:block th:with="labelString=${@msgUtil.get(#locale, '__${label}__')}">
				<th:block th:replace="${contents}" />
			</th:block>
		</div></th:block>
	</div>
	
	<!--/* navbarRoot */-->
	<div th:fragment="navbarRoot(contentsOfNavBarRoot, appName, imagePath, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavBarRoot}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarRoot" th:remove="tag">
			<th:block th:with="navbarBgColor=${
							(loginState == 'public' || loginState == 'ecuacion-public') && navbarBgColorPublic != null ? navbarBgColorPublic : 
							(loginState == 'account' ? navbarBgColorAccount : 
							(loginState == 'admin' ? navbarBgColorAdmin : navbarBgColor
							))}">
				<nav class="navbar navbar-expand-md navbar-dark"
						th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
						+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)}">
					<div class="container-fluid">
						<a class="navbar-brand" th:href="@{/public/show/page?id=home}">
							<th:block th:if="${imagePath != ''}">
								<img th:src="${imagePath}" width="30" height="24" th:classappend="${appName == '' ? '' : 'd-inline-block align-text-top'}">
							</th:block>
							<th:block th:if="${appName != ''}">
								<span th:text="${appName}"></span>
							</th:block>
						</a>
						
						<div class="container">
							<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
								<span class="navbar-toggler-icon"></span>
							</button>
				
							<div class="collapse navbar-collapse" id="navbarText">
								<ul class="navbar-nav me-auto mb-2 mb-lg-0">

										<th:block th:replace="${contentsOfNavBarRoot}" />

								</ul>
							</div>
						</div>
					</div>
				</nav>
			</th:block>
		</div></th:block>
	</div>
		
	<!--/* navbarMenu: A menu link (not dropdown) placed on navigation bars. */-->
	<div th:fragment="navbarMenuItem(href, label, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavBarMenuItem}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarMenuItem" th:remove="tag">
			<li class="nav-item" th:id="${componentId}" style="margin-left: 20px">
				<a class="nav-link" th:href="${href}" th:text="${labelString}"></a>
			</li>
		</div></th:block>
	</div>
	
	<!--/* navbarMenu: A menu link (not dropdown) placed on navigation bars. */-->
	<div th:fragment="navbarSubMenu(label, menuItems, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavbarSubMenu}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavbarSubMenu" th:remove="tag">
			<li class="nav-item dropdown" th:id="${componentId}" style="margin-left: 20px">
				<a class="nav-link dropdown-toggle" href="#" role="button" 
						data-bs-toggle="dropdown" aria-expanded="false" th:text="${labelString}"></a>
				<ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown"
						th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
						+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)}">
						<th:block th:replace="${menuItems}" />
				</ul>
			</li>
		</div></th:block>
	</div>

	<!--/* navbarDropDownMenuItem */-->
	<div th:fragment="navbarDropDownMenuItem(href, label, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavbarDropDownMenuItem}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavbarDropDownMenuItem" th:remove="tag">
			<li th:id="${componentId}"><a class="dropdown-item" th:href="${href}" th:text="${labelString}"></a></li>
		</div></th:block>
	</div>

	<!--/* navbarDropDownMenuDivider */-->
	<div th:fragment="navbarDropDownMenuDivider(options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavbarDropDownMenuDivider}, '', ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavbarDropDownMenuDivider" th:remove="tag">
			<li th:id="${componentId}"><hr class="dropdown-divider"></li>
		</div></th:block>
	</div>

	<!--/* navbarDropDownMenuGroupLabel */-->
	<!--/* 
		It's used when you want to put a classification label. 
		It's supposed to be placed at the top or right after the divider.
	*/-->
	<div th:fragment="navbarDropDownMenuGroupLabel(label, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavbarDropDownMenuGroupLabel}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavbarDropDownMenuGroupLabel" th:remove="tag">
			<li th:id="${componentId}" class="mb-1"><small>
				<div class="ms-3" style="font-weight: bold" th:text="${'&lt; &nbsp;' + labelString + '&nbsp; &gt;'}"></div>
			</small></li>
		</div>
	</div>

	<!--/* navbarDropDownSubMenu */-->
	<div th:fragment="navbarDropDownSubMenu(label, menuItems, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavbarCommonComponent(~{ :: fragmentNavbarDropDownSubMenu}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavbarDropDownSubMenu" th:remove="tag">
			<li th:id="${componentId}">
				<a class="dropdown-item" href="#">
					<div style="text-align: left; float: left;" th:text="${labelString}"></div>
					<div style="text-align: right;" th:text="${options.contains('direction=left') ? '&ltrif;' : '&rtrif;'}">︎</div>
				</a>
				<ul class="dropdown-menu dropdown-submenu dropdown-menu-dark bg-gradient bg-primary"
						th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
						+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)
						+ ' ' + (options.contains('direction=left') ? 'dropdown-submenu-left' : '')}">
					<th:block th:replace="${menuItems}" />
				</ul>
			</li>
		</div></th:block>
	</div>
	 
	<!--/* 
		###process result message components.
	 */-->
	 
	<!--/* messages */-->
	<div th:fragment="messages(options)" th:remove="tag" th:if="${!(noMessages != null && noMessages)}">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentMessages}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentMessages" th:remove="tag">
			<div class="mt-5 mb-5">
				<!-- messages from url parameter -->
				<div class="all-error-messages-list-wrapper text-danger">
					<div class="bg-color-msg-error-bg p-2 rounded-1" 
							th:if="${param.error != null or param.logoutDone != null or param.accessDenied != null or param.notFound != null}">
						<div th:replace="~{ :: freeSpace(~{ ::free-space-login-messages}, '')}"></div>
					</div>
				</div>
				<th:block th:if="false"><div th:fragment="free-space-login-messages" th:remove="tag">
					<div th:if="${param.error}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.error')}"></div>
					<div th:if="${param.logoutDone}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.logoutDone')}"></div>
					<div th:if="${param.accessDenied}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.accessDenied')}"></div>
					<div th:if="${param.notFound}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.notFound')}"></div>
				</div></th:block>
				<!-- messages from ${messagesBean} -->
				<div th:object="${messagesBean}">
					<div class="bg-color-msg-success-bg p-2 rounded-1" th:if="${param.keySet().contains('success') || messagesBean.needsSuccessMessage}">
						<div class="text-success" th:if="${param.success}" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.success')}"></div>
						<div class="text-success" th:if="*{needsSuccessMessage}" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.success')}"></div>
					</div>
					<div class="all-error-messages-list-wrapper text-danger">
						<div class="bg-color-msg-error-bg p-2 rounded-1" th:if="*{errorMessages != null && errorMessages.size() > 0}">
							<!--/* in the case of showing item related message here */-->
							<th:block th:if="${showsMessagesLinkedToItemsAtTheTop}">
								<div class="all-error-messages-list-ul">
									<div th:replace="~{ :: internalDisplayMessages(*{errorMessages})}"></div>
								</div>
							</th:block>
							<!--/* in the case of showing item related message at each item */-->
							<th:block th:if="${showsMessagesLinkedToItemsAtEachItem}">
								<ul class="all-error-messages-list-ul">
									<!--/* showing non-item-related messages */-->
									<th:block th:if="*{errorMessagesNotLinkedToItems.size() > 0}">
										<div th:replace="~{ :: internalDisplayMessages(*{errorMessagesNotLinkedToItems})}"></div>
									</th:block>
									<!--/* showing a message that says there's an error at some of the items */-->
									<th:block th:if="*{errorMessagesLinkedToItems.size() > 0}">
										<div th:replace="~{ :: internalDisplayMessages(${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.messagesLinkedToItemsExist')})}"></div>
									</th:block>
								</ul>
							</th:block>
						</div>
					</div>
				</div>
			</div>
		</div></th:block>
	</div>

	<!--/* message displaying internal common component */-->
	<div th:fragment="internalDisplayMessages(errorMessages)" th:remove="tag">
		<table th:each="message : ${errorMessages}" style="width: 100%;">
			<tr>
				<td style="vertical-align:top; width: 20px"><div style="margin-left: 10px; margin-right: 10px;">- </div></td>
				<td colspan="2"><div class="all-error-messages-list-li" style="white-space: pre-wrap">[[
						${#strings.contains(message, #strings.unescapeJava('\n\n')) ? 
						#strings.substring(message, 0, #strings.indexOf(message, #strings.unescapeJava('\n\n'))) : message}]]</div></td>
			</tr>
			
			<!--/* 
				subMessage feature.
				See the following for error reasons:\n\nreason1: xxx\nreason2: xxx
				-> 
				- See the following for error reasons:
				  - reason1: xxx
				  - reason2: xxx
			 */-->
			<th:block th:if="${#strings.contains(message, #strings.unescapeJava('\n\n'))}">
				<th:block th:each="subMessage : ${#strings.arraySplit(#strings.substring(message, #strings.indexOf(message, #strings.unescapeJava('\n\n'))), #strings.unescapeJava('\n'))}">
					<tr>
						<td></td>
						<td style="vertical-align:top; width: 10px"><div style="margin-right: 10px">- </div></td>
						<td><div class="all-error-messages-list-li" style="white-space: pre-wrap">[[${subMessage}]]</div></td>
					</tr>
				</th:block>
			</th:block>
		</table>
	</div>

	<!--/* 
		### base-page button components.
	 */-->

	<!--/* button */-->
	<div th:fragment="button(id, label, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentButton}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentButton" th:remove="tag">
		<!--/* 
			<button th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" class="btn btn-color-btn text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:text="${label}"></button>
		 */-->
		</div></th:block>
	</div>
	
	<!--/* 
		### base-page script components.
	 */-->

	<!--/* sendZoneOffset */-->
	<div th:fragment="sendZoneOffset(options)" th:remove="tag">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<input type="hidden" id="zoneOffsetParams" th:data-url="@{/public/zoneOffset}">
		<script>
		$(function() {
			var offset = new Date().getTimezoneOffset();
			var url = document.getElementById('zoneOffsetParams').dataset.url;
			$.ajax(url + '?zoneOffset=' + offset,
				{
					type: 'get'
				}
			)
		});
		</script>
	</div>



	<!--/* 
		###
		### general-form-page components
		###
	 */-->

	<!--/* 
		### form components
	 */-->

	<!--/* generalForm */-->
	<div th:fragment="generalForm(formContent, topSpaceContent, bottomSpaceContent
			, formMethod, multipart, subFunction, versionFieldName, versionInitialValue, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentGeneralForm}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentGeneralForm" th:remove="tag">
			<th:block th:with="subFunction=${subFunction == null ? '' : subFunction}">
				<th:block th:with="htmlFormName=${subFunction + (subFunction == '' ? 'form' : 'Form')},
						javaFormName=${function + #strings.capitalize(subFunction) + 'Form'}">
	
					<th:block th:replace="${topSpaceContent}" />
	
					<!--/* issue#156: Since the error message is hard to understand when ${__${javaFormName}__} == null, understandable message output procedure is added. */-->
					<th:block th:if="${__${javaFormName}__} == null"
							th:with="msg=${'Form not found in model. Form name: ' + javaFormName + '. 
									The reason can be: Form with the name not defined; 
									Form is defined but not used (not set in the generics parameter of the controller definition sentence);'}">
						[[${@exUtil.systemError(msg)}]]
					</th:block>
	
					<!--/* subFunction, ctrlSubFunctionの挙動については#454参照。  */-->
					<form th:name="${htmlFormName}" th:id="${htmlFormName}" 
							th:method="${formMethod == null || formMethod == '' ? 'post' : formMethod}"
							th:enctype="${multipart == null || multipart == false ? 'application/x-www-form-urlencoded' : 'multipart/form-data'}"
							th:action="@{/} + ${#strings.replace(loginState, '-', '/')} + '/' + ${functionKindsPathString} + ${function} + ${(ctrlSubFunction == null ? (subFunction == null || subFunction == '' ? '' : '/' + subFunction) : (ctrlSubFunction == '' ? '' : '/' + ctrlSubFunction)) + '/action'}"
							th:object="${__${javaFormName}__}">
						<input type="hidden" name="transactionToken" th:value="${transactionToken}">
				
						<!--/* controller側からmodelに渡すformm名が間違えている場合にいつもここでエラーになるが、設定したform名が取得できずdebugしているので、
						       赤字でエラー表示しつつform名を出力 */-->
						<h1 style="color: red" th:if="${__${function + #strings.capitalize(subFunction) + 'Form'}__} == null">
							form: [[${function + #strings.capitalize(subFunction) + 'Form'}]] is null.
						</h1> 
						
						<!--/* confirmedWarningsで、formの外からボタンクリックが必要なためform名を保持しておく */-->
						<input type="hidden" name="htmlFormName" th:value="${htmlFormName}">
						<input type="hidden" name="confirmedWarnings" th:data-html-form-name="${htmlFormName}" th:value="*{confirmedWarnings}">
			 			<input type="hidden" name="submitOnChangeToRefresh">
						<input type="hidden" th:name="${rootRecordName + '.' + (#strings.isEmpty(versionFieldName) ? 'version' : versionFieldName)}" th:value="${versionInitialValue}" />

						<th:block th:replace="${formContent}" />
			
						<div th:replace="~{ :: internalWarnMessage('')}"></div>
	
		 			</form>
					
					<th:block th:replace="${bottomSpaceContent}" />
			
				</th:block>
			</th:block>
		</div></th:block>
	</div>

	<!--/* internal warn message part */-->
	<div th:fragment="internalWarnMessage(options)" th:remove="tag">
		<div th:object="${messagesBean}">
			<th:block th:if="*{warnMessage != null}">
				<input type="hidden" name="warnMessage" th:data-button-name="*{warnMessage.buttonName}" th:data-msg-id="*{warnMessage.messageId}" th:value="*{warnMessage.message}">
				<script>
					var bl = confirm(this.form.elements['warnMessage'].value);
					var obj = this.form.elements['confirmedWarnings'];
					if (bl) {
						obj.value = obj.value + "," + this.form.elements['warnMessage'].dataset.msgId;
						
						const buttonName = this.form.elements['warnMessage'].dataset.buttonName;
						if (typeof buttonName === "undefined") {
							buttonName = "";
						}
						
						if (buttonName == "") {
							this.form.submit();

						} else {
							var btn = this.form.elements[buttonName];
							btn.click();
						}
						
					} else {
						obj.value = "";
					}
				</script>
			</th:block>
		</div>
	</div>

	<!--/* 
		### general-form-page input components
	 */-->

	<!--/* internalAllInputCommonComponent. */-->
	<!--/* parameters: 
			- itemPropertyPath			String 		not empty	itemPropertyPath (recordPropertyPath NOT accepted)
			- allInputCcontents			Fragment	not empty	a fragment of the component
			- allInputPostfixCcontents	Fragment	empty OK	a fragment of the component
			- required					boolean		not null	a boolean which specifies whether the input component is required to input something.
			- needsLabel				boolean		not null	a boolean which specifies whether the input component is required to input something.
			- needsFieldEmssages		boolean		not null	a boolean which specifies whether the input component is required to input something.
			- labelPostfix				String		not null	postfix for label. When you don't need it, set blank('').
			- options					String		not null	options for the component. When you don't need it, set blank('').
	*/-->
	<!--/* options: 
			- id			arbitrary	specifies 'id' attribute of the html component. As default "htmlFormName + '.' + propertyPath"
			- width			arbitrary	specifies width of the html component. values can be 'full' or 'half'.
			- componentType	arbitrary	speciifes the kind of the component. Used to change the look or action by its type.
			                            'switch' is used in the fragment for now.
			- readOnly		arbitrary	specifies whether the component is read-only.			                            
	*/-->
	<div th:fragment="internalAllInputCommonComponent(itemPropertyPath, allInputCcontents, allInputPostfixCcontents, required, needsLabel, needsFieldEmssages, 
			labelPostfix, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentAllInputCommonComponent}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentAllInputCommonComponent" th:remove="tag">
			<th:block th:with="recordPropertyPathClass=${itemPropertyPath.contains('.') 
					? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
					propertyPathField=${itemPropertyPath.contains('.') 
					? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath},
					itemNameKeyClass=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : rootRecordName}">
				<th:block th:with="recordPropertyPath=${recordPropertyPathClass + '.' + propertyPathField}, itemKindId=${itemNameKeyClass + '.' + propertyPathField}">
					<th:block th:with="inputValue=*{__${recordPropertyPath}__}, inputName=${recordPropertyPath},
							inputId=${@optUtil.getValueOrElse(options, 'id', htmlFormName + '.' + recordPropertyPath)},
							isReadOnly=${@optUtil.hasKey(options, 'readonly')},
							widthValue=${@optUtil.getValueOrElse(options, 'width', '')}, 
							widthNumber=${@optUtil.hasKey(options, 'width') ? (widthValue == 'full' ? '12' : (widthValue == 'half' ? '6' : widthValue)) : ''}">
		
						<div th:id="${componentId}" class="" th:classappend="${widthNumber == '' ? 'col-xl-3 col-lg-4 col-md-6' : 'col-md-' + widthNumber} + ' '
								+ ${mtClass} + ' ' + ${mbClass == '' ? 'mb-4' : mbClass}
						">

							<!--/* label */-->
							<th:block th:if="${needsLabel}"
									th:with="displayName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${itemPropertyPath}__')}">
								<label th:for="${inputId}" class="form-label text-dark">
									[[${@msgUtil.get(#locale, '__${displayName}__')}]] [[${labelPostfix + ' '}]]<span class="text-danger" th:if="${required}">*</span>
								</label>
							</th:block>

							<!--/* content */-->
							<th:block th:replace="${allInputCcontents}" />
							
							<!--/* field messages */-->
							<th:block th:if="${showsMessagesLinkedToItemsAtEachItem} and ${needsFieldEmssages}">
								<div class="text-danger" th:if="${messagesBean.getErrorMessages('__${recordPropertyPath}__') != null}"
									th:classappend="${@optUtil.hasKey(options, 'componentType') and @optUtil.getValue(options, 'componentType') == 'switch' ? 'mt-1' : ''}"
									th:each="message : ${messagesBean.getErrorMessages('__${recordPropertyPath}__')}">[[${message}]]</div>
							</th:block>
							
							<!--/* postfix content */-->
							<th:block th:replace="${allInputPostfixCcontents}" />
							
						</div>
					</th:block>
				</th:block>
			</th:block>	
		</div></th:block>
	</div>

	<!--/* internalAllHtmlInputComponent. */-->
	<div th:fragment="internalAllHtmlInputComponent(position)" th:remove="tag">
		<input th:type="${type}" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}"
				th:maxlength="${isReadOnly || type == 'hidden' || needsMaxLength == null || !needsMaxLength} ? '' : *{__${recordPropertyPathClass}__.getStringLength('__${propertyPathField}__')}"
				th:classappend="${isReadOnly ? 'form-control-plaintext' : 'form-control'}
						+ ' ' + ${position == 'right' ? 'text-end' : ''}
						+ ' ' + ${messagesBean.isValid(recordPropertyPath)}" 
				th:readonly="${isReadOnly}">
	</div>

	<!--/* internalAllHtmlInputNumberComponent. */-->
	<div th:fragment="internalAllHtmlInputNumberComponent" th:remove="tag">
		<th:block th:with="needsCommas=*{__${rootRecordName}__.needsCommas('__${rootRecordName}__', '__${itemPropertyPath}__')}">
			<th:block th:with="type=text, inputValue=${(needsCommas && inputValue != null) ? #numbers.formatDecimal(#strings.replace(inputValue, ',', ''), 1, 'COMMA', 0, 'POINT') : inputValue}">
				<div th:replace="~{ :: internalAllHtmlInputComponent('right')}"></div>
			</th:block>
			<th:block th:if="${needsCommas}">
				<script th:inline="javascript">
					addNumberFormatFunction(/*[[${inputId}]]*/);
				</script>
			</th:block>
		</th:block>
	</div>

	<!--/* internalAllHtmSelectComponent. */-->
	<div th:fragment="internalAllHtmSelectComponent" th:remove="tag">
		<!--/* disabled is used because select component does not have readonly readOnly attribute */-->
		<th:block th:if="${isReadOnly}">
			<input type="hidden" th:id="${@optUtil.hasKey(options, 'id') ? recordPropertyPath : null}" th:name="${recordPropertyPath}" th:value="${inputValue}">
		</th:block>
	
		<select th:id="${inputId}" th:name="${inputName}"
				class="form-select" th:classappend="${messagesBean.isValid(recordPropertyPath)}"
				th:disabled="${isReadOnly}"
				th:data-submit-on-change-to-refresh="${@optUtil.hasKey(options, 'submitOnChangeToRefresh')}"
				th:data-html-form-name="${htmlFormName}"
				onchange="if (this.dataset.submitOnChangeToRefresh == 'true') {document.forms[this.dataset.htmlFormName].elements['submitOnChangeToRefresh'].value = 'true'; this.form.submit();}">
			<option th:if="${@optUtil.needsEmptyOption(options)}" th:selected="${inputValue == null || inputValue == ''}"></option>
			<th:block th:each="pair : ${pairs}">
				<option th:value="${pair[0]}" th:selected="${pair[0] == inputValue}">[[${pair[1]}]]</option>
			</th:block>
		</select>
	</div>

	<!--/* internalEditInputCommonComponent. */-->
	<div th:fragment="internalEditInputCommonComponent(itemPropertyPath, editInputContents, editInputContentsPostfix, options)" th:remove="tag">
		<!--/* #authentication.principal is a bean which stores multiple values when logged in, but is a String when not logged in. That's why the check whether its dataType is string is needed. */-->
 		<div th:replace="~{ :: internalAllInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentEditInputCommonComponent}, ${editInputContentsPostfix}, 
 				*{__${rootRecordName}__.isNotEmpty('__${itemPropertyPath}__', '__${loginState}__', '__${#authentication.principal.class.name == 'java.lang.String' ? '' : #authentication.principal.authorities}__')},
 				 true, true, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentEditInputCommonComponent" th:remove="tag">
			<th:block th:replace="${editInputContents}" />
		</div></th:block>
		
	</div>
	
	<!--/* internalEditInputTextComponent. */-->
	<div th:fragment="internalEditInputTextComponent(itemPropertyPath, type, needsMaxLength, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ :: internalAllHtmlInputComponent('left')}, ~{ :: fragmentNoContents}, ${options})}"></div>
	</div>
	
	<!--/* textbox */-->
	<div th:fragment="inputText(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputTextComponent(${itemPropertyPath}, 'text', true, ${options})}"></div>
	</div>
				
	<!--/* textbox(password) */-->
	<div th:fragment="inputPassword(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputTextComponent(${itemPropertyPath}, 'password', true, ${options})}"></div>
	</div>

	<!--/* hidden */-->
	<div th:fragment="inputHidden(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="type=hidden">
	 		<div th:replace="~{ :: internalAllInputCommonComponent(${itemPropertyPath}, ~{ :: internalAllHtmlInputComponent(null)}, ~{ :: fragmentNoContents}, 
	 				false, false, false, '',  ${options})}"></div>
 		</th:block>
	</div>
	
	<!--/* inputNumber */-->
	<div th:fragment="inputNumber(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ :: internalAllHtmlInputNumberComponent}, ~{ :: fragmentNoContents}, ${options})}"></div>
	</div>
	
	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalEditInputDateTime(itemPropertyPath, type, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputTextComponent(${itemPropertyPath}, ${type}, false, ${options})}"></div>
	</div>	

	<!--/* textbox(month) */-->
	<div th:fragment="inputYearMonth(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputDateTime(${itemPropertyPath}, 'month', ${options})}"></div>
	</div>

	<!--/* textbox(date) */-->
	<div th:fragment="inputDate(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputDateTime(${itemPropertyPath}, 'date', ${options})}"></div>
	</div>

	<!--/* textbox(time) */-->
	<div th:fragment="inputTime(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputDateTime(${itemPropertyPath}, 'time', ${options})}"></div>
	</div>

	<!--/* textarea */-->
 	<div th:fragment="inputTextArea(itemPropertyPath, options)" th:remove="tag">
 		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputTextArea}, ~{ :: fragmentNoContents}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputTextArea" th:remove="tag">
			<textarea th:id="${inputId}" th:name="${inputName}" th:text="${inputValue}"
				th:maxlength="*{__${recordPropertyPathClass}__.getStringLength('__${propertyPathField}__')}" 
				th:classappend="${(isReadOnly) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(recordPropertyPath)}" 
				th:readonly="${isReadOnly}" rows="3">
			</textarea>
		</div></th:block>
	</div>

	<!--/* checkbox (switch) */-->
	<div th:fragment="inputSwitch(itemPropertyPath, options)" th:remove="tag">
 		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputSwitch}, ~{ :: fragmentNoContents}, ${options + ',componentType=switch'})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputSwitch" th:remove="tag">
			<div class="form-check form-switch mt-2">
				<th:block th:if="${isReadOnly}">
					<input type="hidden" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}">
				</th:block>
				<div>
					<input type="hidden" th:name="${isReadOnly ? '' : inputName}" value="off">
					<input th:id="${inputId}" th:name="${isReadOnly ? '' : recordPropertyPath}"
						class="form-check-input align-bottom mb-1" type="checkbox" 
						th:checked="${inputValue}"
						th:classappend="${messagesBean.isValid(recordPropertyPath)}"
						th:disabled="${isReadOnly}">
				</div>
			</div>
		</div></th:block>
	</div>
	 
	<!--/* checkbox */-->
	<div th:fragment="inputCheckboxes(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputCheckboxes}, ~{ :: fragmentNoContents}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputCheckboxes" th:remove="tag">
			<div class="form-check mt-2" th:each="option : *{__${recordPropertyPath + 'List'}__}">
				<th:block th:with="optionId=${option[0]},optionLabel=${option[1]},optionOptions=${option.length == 2 ? '' : option[2]}">
					<input th:id="${optionId}" class="form-check-input align-bottom mb-1" type="checkbox" 
						th:name="${isReadOnly ? '' : recordPropertyPath}" 
						th:checked="${inputValue == null ? false : #strings.contains(inputValue, optionId)}"
						th:classappend="${messagesBean.isValid(recordPropertyPath)}"
						th:disabled="${isReadOnly}"
						th:value="${optionId}">
					<label class="form-check-label text-dark" th:for="${optionId}" th:text="${optionLabel}"></label>
					<th:block th:if="${isReadOnly}">
						<input type="hidden" th:name="${recordPropertyPath}" th:value="${optionId}">
					</th:block>
				</th:block>
			</div>
		</div></th:block>
	</div>

	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalEditInputSelectComponent(itemPropertyPath, pairs, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ :: internalAllHtmSelectComponent}, ~{ :: fragmentNoContents}, ${options})}"></div>
	</div>
	
	<div th:fragment="inputSelect(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputSelectComponent(${itemPropertyPath}, *{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__()}, ${options})}"></div>
	</div>
	
	<div th:fragment="inputSelectWithLocale(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputSelectComponent(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>
	
	<!--/* 
		- options:
		  - including: Shows selections specified in this options only. Example: 'include=ADMIN,GROUP_ADMIN' Element name of the enum, not the code value.
		  - excluding: Shows selections NOT specified in this options only. Example: 'include=ADMIN,GROUP_ADMIN' Element name of the enum, not the code value.
		  - firstCharOfCodeEqualTo: Shows selections whose first character is equal to the one specified.
		  - firstCharOfCodeLessThanOrEqualTo: Shows selections whose first character is less than or equal to the one spefied. Compared by ascii code number.
		  - firstCharOfCodeGreaterThanOrEqualTo: Shows selections whose first character is greaterl than or equal to the one spefied. Compared by ascii code number.
	 */-->
	<div th:fragment="inputSelectFromEnum(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputSelectComponent(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>
	
	<!--/* component for file upload */-->
	<div  th:fragment="inputFile(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentInputFile}, ~{ :: fragmentNoContents}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputFile" th:remove="tag">
			<input class="form-control" type="file" th:id="${inputId}" th:name="${inputName}" 
					th:classappend="${messagesBean.isValid(recordPropertyPath)}">
		</div></th:block>
	</div>
	
	<!--/* component for taken photo upload for mobile */-->
	<div  th:fragment="inputTakenPhotoMobile(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentInputTakenPhotoMobile}, ~{ :: fragmentInputTakenPhotoMobilePostfix}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputTakenPhotoMobile" th:remove="tag">
			<input class="form-control" th:classappend="${messagesBean.isValid(recordPropertyPath)}" 
					type="file" th:name="${recordPropertyPath}"  th:id="${inputId}" accept="image/*" capture="user">
		</div></th:block>
		
		<th:block th:if="false"><div th:fragment="fragmentInputTakenPhotoMobilePostfix" th:remove="tag">
			<th:block th:with="photoData=*{__${recordPropertyPath + 'RegisteredBase64'}__}">
				<th:block th:if="${!#strings.isEmpty(photoData)}">
					<br>
					[[${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.components.inputTakenPhoto.registeredPhoto')}]]
					<img class="img-fluid" th:src="${photoData}" style="border: 1px solid #000;">
				</th:block>
			</th:block>
		</div></th:block>
	</div>

	<!--/* component for taken photo upload for PC */-->
	<div  th:fragment="inputTakenPhotoPc(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalEditInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentInputTakenPhotoPc}, ~{ :: fragmentNoContents}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputTakenPhotoPc" th:remove="tag">
			<video th:id="${'video-' + inputId}" width="320" height="240" autoplay muted style="border: 1px solid #000;"></video>
			<canvas th:id="${'canvas-' + inputId}" width="320" height="240"></canvas>
			<img th:id="${'photo-' + inputId}" src="#" alt="taken photo" style="border: 1px solid #000;">
			<input type="hidden" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}">
			<div class="mt-2"></div>
			<button th:id="${'allowance-' + inputId}" type="button" style="vertical-align: bottom;" class="btn btn-sm btn-color-btn text-white bg-gradient" 
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.components.inputTakenPhotoPc.photoShootingButtonLabel')}"></button>
			<button th:id="${'capture-' + inputId}" type="button" style="vertical-align: center;" class="btn btn-sm btn-color-btn text-white bg-gradient"
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.components.inputTakenPhotoPc.shootButtonLabel')}"></button>
			<button th:id="${'recapture-' + inputId}" type="button" style="vertical-align: bottom;" class="btn btn-sm btn-color-btn text-white bg-gradient"
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.components.inputTakenPhotoPc.reshootButtonLabel')}"></button>
		
			<script>
				const video = document.getElementById('video-[[${inputId}]]');
				const canvas = document.getElementById('canvas-[[${inputId}]]');
				const photo = document.getElementById('photo-[[${inputId}]]');
				const hidden = document.getElementById('[[${inputId}]]');
				const allowanceButton = document.getElementById('allowance-[[${inputId}]]');
				const captureButton = document.getElementById('capture-[[${inputId}]]');
				const recaptureButton = document.getElementById('recapture-[[${inputId}]]');
				let stream;
		
				video.style.display = 'none';
				canvas.style.display = 'none';
				photo.style.display = 'none';
				captureButton.style.display = 'none';
				recaptureButton.style.display = 'none';
				
				if (hidden.value != "") {
					photo.style.display = 'flex';
					photo.setAttribute('src', hidden.value);
				}
				
				// Procedure for allowance button pressed
				allowanceButton.addEventListener('click', function() {
					// Request for the access allowance of camera.
					navigator.mediaDevices.getUserMedia({ video: true })
						.then(function(mediaStream) {
							stream = mediaStream;
							video.srcObject = stream;
							video.onloadedmetadata = function(e) {
							  video.play();
							};
		
							video.style.display = 'flex';
							photo.style.display = 'none';
							allowanceButton.style.display = 'none';
							captureButton.style.display = 'flex';
							
							// Get photo data from canvas.
							photo.setAttribute('src', '');
							hidden.value = '';
						})
						.catch(function(err) {
							console.log("Access error to camera: " + err);
						});
				});
		
				// Procedure for capture button pressed
				captureButton.addEventListener('click', function() {
					const context = canvas.getContext('2d');
					context.drawImage(video, 0, 0, canvas.width, canvas.height);
					 
					video.style.display = 'none';
					photo.style.display = 'flex';
					captureButton.style.display = 'none';
					recaptureButton.style.display = 'inline-block';

					// Get photo data from canvas.
					photo.setAttribute('src', canvas.toDataURL('image/jpeg'));
					hidden.value = canvas.toDataURL('image/jpeg');
				});

				// Procedure for recapture button pressed
				recaptureButton.addEventListener('click', function() {
					const context = canvas.getContext('2d');
					context.drawImage(video, 0, 0, canvas.width, canvas.height);
	
					video.style.display = 'flex';
					photo.style.display = 'none';
					captureButton.style.display = 'inline-block';
					recaptureButton.style.display = 'none';
					
					// Clear photo data.
					photo.setAttribute('src', '');
					hidden.value = '';
				});
			</script>
		</div></th:block>
	</div>
	
	<!--/* 
		### general-form-page button
	 */-->

	<!--/* internal common navBar component. */-->
	<div th:fragment="internalButtonCommonComponent(id, label, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentButtonCommonComponent}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentButtonCommonComponent" th:remove="tag">
			<button type="submit" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" class="btn btn-color-btn text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:text="${@msgUtil.get(#locale, label)}"></button>
		</div></th:block>
	</div>
	
	<!--/* common button */-->
	<div th:fragment="commonPrimaryButton(id, label, options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent(${id}, ${label}, ${options})}"></div>
	</div>

	<!--/* backButton */-->
	<div th:fragment="backButton(options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent('back', 'jp.ecuacion.splib.web.common.button.back', ${options})}"></div>
	</div>
	
	<!--/* inter-button space */-->
	<span th:fragment="interButtonSpace(options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent(~{ :: fragmentInterButtonSpace}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInterButtonSpace" th:remove="tag">
			<span>&nbsp;&nbsp;&nbsp;</span>
		</div></th:block>
	</span>



	<!--/* 
		###
		### search-page components
		###
	 */-->
	
	<!--/* 
		### search-page input components
	 */-->
	 
	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalSearchInputCommonComponent(itemPropertyPath, searchInputContents, labelPostfix, options)" th:remove="tag">
		<!--/* #authentication.principal is a bean which stores multiple values when logged in, but is a String when not logged in. That's why the check whether its dataType is string is needed. */-->
		<div th:replace="~{ :: internalAllInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentSearchInputCommonComponent}, ~{ :: fragmentNoContents}, 
		*{__${rootRecordName}__.isRequiredOnSearch('__${itemPropertyPath}__', '__${loginState}__', '__${#authentication.principal.class.name == 'java.lang.String' ? '' : #authentication.principal.authorities}__')},
		true, true, ${labelPostfix}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSearchInputCommonComponent" th:remove="tag">
			<th:block th:replace="${searchInputContents}" />
		</div></th:block>
	</div>
	
	<div th:fragment="searchText(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchInputCommonComponent(${itemPropertyPath}, ~{ :: internalAllHtmlInputComponent('left')}, 
				*{__${rootRecordName}__.getSearchPatternComment(#locale, '__${itemPropertyPath}__')}, ${options})}"></div>
	</div>

	<div th:fragment="searchNumber(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchInputCommonComponent(${itemPropertyPath}, ~{ ::searchNumberInternal(${itemPropertyPath}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchNumberInternal(itemPropertyPath, options)" th:remove="tag">
			<input type="text" th:id="${@optUtil.hasKey(options, 'id') ? inputId : null}" th:name="${inputId}" th:value="${inputValue}"
				class="text-end"
				th:classappend="${(isReadOnly) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(inputId)}"
				th:maxlength="${isReadOnly} ? '' : *{__${recordPropertyPathClass}__.getStringLength('__${fieldName}__')}"
				th:readonly="${isReadOnly}">
		</div></th:block>
	</div>
	 
	<div th:fragment="searchDate(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchInputCommonComponent(${itemPropertyPath}, ~{ ::searchDateInternal(${itemPropertyPath}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchDateInternal(itemPropertyPath, options)" th:remove="tag">
			<input type="date" th:id="${@optUtil.hasKey(options, 'id') ? inputId : null}" th:name="${inputId}" th:value="${inputValue}"
				th:classappend="${(isReadOnly) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(inputId)}" 
				th:readonly="${isReadOnly}">
		</div></th:block>
	</div>
	
	<!--/* internal common component */-->
	<div th:fragment="searchComponentSelect(itemPropertyPath, pairs, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchInputCommonComponent(${itemPropertyPath}, ~{ :: internalAllHtmSelectComponent}, '',  ${options})}"></div>
	</div>

	<div th:fragment="searchSelect(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: searchComponentSelect(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__()}, ${options})}"></div>
	</div>
	
	<!--/* 
		- options:
		  - including: 指定したEnum要素のみをプルダウンに表示。'include=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - excluding: 指定したEnum要素以外をプルダウンに表示。'exclude=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - firstCharOfCodeEqualTo: codeの一文字目が等しい場合にtrue
		  - firstCharOfCodeLessThanOrEqualTo: codeの一文字目をascii codeの大小で比較
		  - firstCharOfCodeGreaterThanOrEqualTo: codeの一文字目をascii codeの大小で比較
	 */-->
	<div th:fragment="searchSelectFromEnum(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: searchComponentSelect(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>

	<!--/* 
		### search-page button components
	 */-->

	<!--/* searchButton */-->
	<div th:fragment="searchButton(options)" th:remove="tag">
		<button type="submit" name="search" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.search')}"></button>
	</div>

	<!--/* searchConditionClearButton */-->
	<div th:fragment="searchConditionClearButton(options)" th:remove="tag">
		<button type="submit" name="conditionClear" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.conditionClear')}"></button>
	</div>
	
	<!--/* 
		### search result display condition components (sort, pagination and lines of display in the table)
	 */-->
	
	<!--/* component which is integrated with functions of sort, paging and lines of data */-->
	<div th:fragment="sortPagingAndRecordsInScreen(form, options)" th:remove="tag">
		<input type="hidden" id="sortItem" name="sortItem" th:value="${form.sortItem}">
		<input type="hidden" id="direction" name="direction" th:value="${form.direction}">
		<input type="hidden" id="page" name="page" th:value="${form.page}">
		<input type="hidden" id="recordsInScreen" name="recordsInScreen" th:value="${form.recordsInScreen}">
		<input type="hidden" id="requestFromSearchForm" name="requestFromSearchForm" value="true">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-4 align-self-end">
					<div>[[${form.linesInScreen}]]</div>
				</div>
				<div class="col-md-4">
					<nav aria-label="Page navigation" th:if="${form.getPagerInfoList(#locale).size() > 0}">
						<ul class="pagination justify-content-center">
							<th:block th:each="pagerInfo : ${form.getPagerInfoList(#locale)}" th:object="${pagerInfo}" th:remove="tag">
								<li class="page-item" th:classappend="*{status}">
									<a th:if="*{isDisabled()}" class="page-link text-light" href="#" tabindex="-1" aria-disabled="true" th:text="*{displayString}"></a>
									<a th:if="*{!isDisabled()}" class="page-link" th:data-page="*{goToPage}" 
											href="#" onClick="listFromPage(this.dataset.page);" th:text="*{displayString}"></a>
								</li>
							</th:block>
						</ul>
					</nav>
				</div>
				<div class="col-md-4" style="text-align:right; padding-right: 0px">
					<div class="dropdown">
						<button class="text-white btn btn-color-paging-btn dropdown-toggle mb-3" 
								th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
								type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
							[[${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.label.recordsInScreen')}]]
						</button>
						<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(5)">5</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(10)">10</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(20)">20</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(50)">50</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(100)">100</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--/* 
		### search-page script
	 */-->
	 
	<!--/* javaScript for inline update button. inline update buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptForThSortable(options)" th:remove="tag">
		<script>
		function list(sortItem, direction) {
			document.getElementById("sortItem").value = sortItem;
			document.getElementById("direction").value = direction;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>	
	</div>
	
	<div th:fragment="scriptForRecordsInScreen(options)" th:remove="tag">
		<script>
		function listFromRecordsInScreen(recordsInScreen) {
			document.getElementById("recordsInScreen").value = recordsInScreen;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>
	</div>

	<div th:fragment="scriptForPagenation(options)" th:remove="tag">
		<script>
		function listFromPage(page) {
			document.getElementById("page").value = page;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>
	</div>
	
	<!-- /* 3つのscriptをまとめたもの。htmlパーツ側も結局セットにしたのでscript側もセットで使用することとする */ -->
	<div th:fragment="scriptForSortPagingAndRecordsInScreen(options)" th:remove="tag">
		<div th:replace="~{ :: scriptForThSortable('')}"></div>
		<div th:replace="~{ :: scriptForRecordsInScreen('')}"></div>
		<div th:replace="~{ :: scriptForPagenation('')}"></div>
	</div>



	<!--/* 
		###
		### list-page components.
		###
	 */-->

	<!--/* 
		### search-page script
	 */-->

	<!--/* 
		### table header(th).
	 */-->

	<!--/* sort不可能なth。text-alignはcenter固定。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thText(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: thCustomizable(${itemPropertyPath}, 'center', ${options})}"></div>
	</div>
	
	<!--/* sort可能なth。text-alignはcenter固定。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thSortable(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: thCustomizable(${itemPropertyPath}, 'center', ${options + ',thSortable'})}"></div>
	</div>
	
	<!--/* カスタマイズ可能なsort可能なth。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thCustomizable(itemPropertyPath, position, options)" th:remove="tag">
		<th:block th:with="recordName=${itemPropertyPath.contains('.') ? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
				fieldName=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath}">
			<th:block th:with="id=${recordName + '.' + fieldName},labelFieldName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${itemPropertyPath}__')}">
				<th:block th:if="${@optUtil.hasThSortable(options)}">
					<th scope="col" th:class="'text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
							style="cursor: pointer" th:text="#{__${labelFieldName}__}" 
							th:data-item="${itemPropertyPath}" th:data-direction="${form.nextDirection('__${itemPropertyPath}__')}"
							onClick="list(this.dataset.item, this.dataset.direction);"></th>
		 		</th:block>
		 		<th:block th:if="${!@optUtil.hasThSortable(options)}">
					<th scope="col" th:class="'text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
							th:text="#{__${labelFieldName}__}"></th>
		 		</th:block>
	 	</th:block>
	</div>
	
	<!--/* th with label string */-->
	<div th:fragment="thFreeText(label, options)" th:remove="tag">
		<th scope="col" class="text-center" th:text="${@msgUtil.get(#locale, label)}"></th>
	</div>
	
	<!-- update button -->
	<div th:fragment="thUpdateButton(options)" th:remove="tag">
		<div th:replace="~{ :: thFreeText('jp.ecuacion.splib.web.common.button.update', ${options})}"></div>
	</div>
	
	<!-- delete button -->
	<div th:fragment="thDeleteButton(options)" th:remove="tag">
		<div th:replace="~{ :: thFreeText('jp.ecuacion.splib.web.common.button.delete', ${options})}"></div>
	</div>

	<!--/* 
		### The followings are td components.
	 */-->

	<!--/* td readOnly customizable */-->
	<!--/* context options: (temporary)
			- th:with="deleted=true"	adds a deleted line effect.
	*/-->
	<div th:fragment="tdReadOnlyCustomizable(value, position, options)" th:remove="tag">
		<td th:class="'align-middle fs-6 text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
				th:th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}"
				th:classappend="${(deleted != null && deleted) || @optUtil.isDeleted(options)} ? 'text-deleted' : 'text-dark'">
			<th:block th:if="${@optUtil.hasLinkUrl(options)}">
				<a th:href="${@optUtil.getLinkUrl(options)}" target="_blank">[[${value}]]</a>
			</th:block>
			<th:block th:if="${@optUtil.hasLinkUrl(options) == false}">
				[[${value}]]
			</th:block>
		</td>
	</div>
	
	<!--/* td readOnly text */-->
	<div th:fragment="tdReadOnlyText(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(itemPropertyPath)}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly number */-->
	<div th:fragment="tdReadOnlyNumber(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(itemPropertyPath)},
				needsCommas=*{needsCommas('__${rootRecordName}__', '__${itemPropertyPath}__')}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${((needsCommas && @strUtil.isNumberFormat(value)) ? #numbers.formatDecimal(value, 1, 'COMMA', 0, 'POINT')
					: value)}, 'right', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly fixed length */-->
	<div th:fragment="tdReadOnlyFixedLength(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(itemPropertyPath)}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'center', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly free text */-->
	<div th:fragment="tdReadOnlyFreeText(value, options)" th:remove="tag">
		<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
	</div>
	
	<!--/* td readOnly free fixed length */-->
	<div th:fragment="tdReadOnlyFreeFixedLength(value, options)" th:remove="tag">
		<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'center', ${options})}"></div>
	</div>
	
	<!--/* td readOnly enum text */-->
	<div th:fragment="tdReadOnlyEnumText(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.get__${#strings.capitalize(itemPropertyPath)}__Name(#locale)}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly checkbox */-->
	<div th:fragment="tdReadOnlyCheckbox(itemPropertyPath, options)" th:remove="tag">
		<td class="align-middle text-center" th:th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<input class="form-check-input align-bottom mb-1 " type="checkbox" th:checked="*{__${itemPropertyPath}__}" disabled>
		</td>
	</div>
	
	<!--/* inline input number */-->
	<div th:fragment="tdInputNumber(itemPropertyPath, idValue, options)" th:remove="tag">
		<td class="align-middle text-center" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<th:block th:with="recordName=${itemPropertyPath.contains('.') ? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
					fieldName=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath},
					isReadOnly=${@optUtil.hasKey(options, 'readOnly')}">
				<th:block th:with="id=${recordName + '.' + fieldName + '_' + idValue},value=${rec.getValue(itemPropertyPath)},
						needsCommas=*{needsCommas('__${rootRecordName}__', '__${itemPropertyPath}__')}">
					<input th:type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}"
							th:value="${(needsCommas && @strUtil.isNumberFormat(value)) ? #numbers.formatDecimal(#strings.replace(value, ',', ''), 1, 'COMMA', 0, 'POINT') : value}"
							class="text-end form-control-sm fs-6 text-dark"
							th:classappend="${(isReadOnly) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}" 
							th:readonly="${isReadOnly}">
					<th:block th:if="${needsCommas}">
					<script th:inline="javascript">
						addNumberFormatFunction(/*[[${id}]]*/);
					</script>
					</th:block>
				</th:block>
			</th:block>
		</td>
	</div>

	<!--/* inline update button */-->
	<div th:fragment="tdUpdateButton(id, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="10px" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<button type="submit" th:id="'update_' + ${id}" name="showUpdateForm" class="btn btn-sm btn-color-btn text-white"
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-version="${version}"
					onClick="update('listForm', this.id, this.dataset.version);"
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.update')}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
		</td>
	</div>
	
	<!--/* inline delete button */-->
	<div th:fragment="tdDeleteButton(id, recordValueDisplayedOnDelete, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="0px" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<button type="submit" th:id="'delete_' + ${id}" name="delete" class="btn btn-sm btn-color-btn-danger text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-form-name="listForm" th:data-item="${recordValueDisplayedOnDelete}" th:data-version="${version}"
					th:onClick="return del(this.dataset.formName, this.id, this.dataset.item, this.dataset.version);" 
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.delete')}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
		</td>
	</div>

	<!--/* general button */-->
	<div th:fragment="tdButton(itemPropertyPath, id, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="10px" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<button type="submit" th:id="${itemPropertyPath} + '_' + ${id}" th:name="${itemPropertyPath}" class="btn btn-sm btn-color-btn text-white"
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-version="${version}"
					th:text="#{__${itemPropertyPath}__}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
			<th:block th:if="${@optUtil.needsOnclickJs(options)}">
				<script th:inline="javascript">
					onTdButtonClick(/*[[${itemPropertyPath}]], [[${id}]]*/);
				</script>
			</th:block>
		</td>
	</div>
	
	<!--/* hidden input for inline button. 上のいずれかのinline buttonを配置する場合は、同一form内にこれを一つ（tableなどのループの外に）置く。中身はただのhiddenだがわかりやすくするため。 */-->
	<div th:fragment="hiddenForInlineButtons(rootRecordName, idFieldName, options)" th:remove="tag">
		<input type="hidden" th:id="${rootRecordName + '.' + idFieldName}" th:name="${rootRecordName + '.' + idFieldName}">
	</div>
	
	<!--/* javaScript for inline update button. inline update buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptFortdUpdateButton(rootRecordName, idFieldName, versionFieldName, options)" th:remove="tag">
		<script th:with="id=${rootRecordName + '.' + idFieldName},versionId=${rootRecordName + '.' + versionFieldName}">
		function update(formName, id, version) {
			document.getElementById("[[${id}]]").value = id.replace('update_', '');
			document.forms[formName].elements["[[${versionId}]]"].value = version;
		}
		</script>
	</div>

	<!--/* javaScript for inline delete button. inline delete buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptFortdDeleteButton(rootRecordName, idFieldName, versionFieldName, itemDisplayedOnDelete, options)" th:remove="tag">
		<script th:with="id=${rootRecordName + '.' + idFieldName},versionId=${rootRecordName + '.' + versionFieldName}">
		function del(formName, id, recordName, version) {
			var message = "[[${@optUtil.getDeleteConfirmMessage(rootRecordName, itemDisplayedOnDelete)}]]" + " " + recordName;
			var bl = confirm(message);
			if (!bl) return false;
			
			document.getElementById("[[${id}]]").value = id.replace('delete_', '');
			document.forms[formName].elements["[[${versionId}]]"].value = version;

			return true;
		}
		</script>
	</div>

	<!--/* 
		### button.
	 */-->

	<!--/* showInsertFormButton */-->
	<div th:fragment="showInsertFormButton(options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent('showInsertForm', 'jp.ecuacion.splib.web.common.button.insert', ${options})}"></div>
	</div>

	<!--/* insertOrUpdateButton */-->
	<div th:fragment="insertOrUpdateButton(isInsert, options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent('insertOrUpdate', 
				${isInsert ? 'jp.ecuacion.splib.web.common.button.insert' : 'jp.ecuacion.splib.web.common.button.update'}, ${options})}"></div>
	</div>
</body>
</html>
