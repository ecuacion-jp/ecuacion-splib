<!--

    Copyright © 2012 ecuacion.jp (info@ecuacion.jp)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
</head>
<body>

	<!--/* 
		###
		### components available in any pages
		###
	 */-->
	 
	<!--/* 
		### common components
	 */-->
	 
	<!--/* allComponentsExternalFrame */-->
	<!--/* parameters:
		- createsComponentIdDiv:	If it's true, <div th:id="${componentId}"> is created. 
		  If it's false (=you don't want to add 'id' attribute to div component), caller component need to implement component as id = ${componentId}. 
	 */-->
	<!--/* options:
		- componentId	(an arbitrary string)	Specifies 'id' attribute of the whole. 
												As default id value is the same as the value of name for html controls.
 	 */-->
	<div th:fragment="internalAllCommonComponent(contentsOfAllCommon, createsComponentIdDiv, options)" th:remove="tag">
		<th:block th:with="componentId=${@optUtil.getValueOrElse(options, 'componentId', null)}">
			<div th:if="${createsComponentIdDiv}" th:id="${componentId}">
				<th:block th:replace="${contentsOfAllCommon}" />
			</div>

			<th:block th:if="${!createsComponentIdDiv}">
				<th:block th:replace="${contentsOfAllCommon}" />
			</th:block>
		</th:block>
	</div>

	<!--/* 
		### message displaying components
	 */-->

	<!--/* internal common display message component */-->
	<!--/* 
		'title' and 'message' can be the key to the message.properties or item_names.properties, 
		or if it does not exist in properties files, it shows the string directly.
	*/-->
	<div th:fragment="internalMessageDisplayCommonComponent(contents, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentMessageDisplayCommonComponent}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentMessageDisplayCommonComponent" th:remove="tag">
			<div class="text-dark" 
					th:with="titleString=${@msgUtil.get(#locale, title)},
					messageString=${@msgUtil.get(#locale, message)}">
				<th:block th:replace="${contents}" />
				
			</div>
		</div>
	</div>

	<!--/* title */-->
	<div th:fragment="title(title, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: titleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="titleInternal" th:remove="tag">
			<div class="fs-3 fw-bold mt-3 mb-5" th:text="${titleString}"></div>
		</div></th:block>
	</div>

	<!--/* titleDesc */-->
	<!--/* It's placed above the message space, so it does not seem very useful. Maybe it will become deprecated in the future. */-->
	<div th:fragment="titleDesc(message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: titleDescInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="titleDescInternal" th:remove="tag">
			<th:block th:if="${!#strings.isEmpty(messageString)}">
				<div class="mb-5" style="white-space: pre-wrap;" th:text="${messageString}"></div>
			</th:block>
		</div></th:block>
	</div>

	<!--/* subtitle  */-->
	<div th:fragment="subtitle(title, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: subtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="subtitleInternal" th:remove="tag">
			<div class="border-5 border-color-subtitle fs-5 fw-bold mt-5 pt-1 pb-1 ps-3" style="border-left: solid;" th:text="${titleString}"></div>
		</div></th:block>
	</div>

	<!--/* paragraphWithSubtitle */-->
	<div th:fragment="paragraphWithSubtitle(title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: paragraphWithSubtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphWithSubtitleInternal" th:remove="tag">
 			<div th:replace="~{ :: subtitleInternal}"></div>
			<div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* subtitle  */-->
	<div th:fragment="subsubtitle(title, options)" th:remove="tag">
		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: subsubtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="subsubtitleInternal" th:remove="tag">
			<div>
				<div class="mt-5 mb-3 pt-1 pb-1 ps-3">
					<span class="text-color-subtitle me-3 fs-7 fw-bold">-︎</span><span class="fs-5 fw-bold" th:text="${titleString}"></span>
				</div>
			</div>
		</div></th:block>
	</div>

	<!--/* paragraphWithSubsubtitle */-->
	<div th:fragment="paragraphWithSubsubtitle(title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: paragraphWithSubsubtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphWithSubsubtitleInternal" th:remove="tag">
 			<div th:replace="~{ :: subsubtitleInternal}"></div>
			<div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* paragraph */-->
	<div th:fragment="paragraph(message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: paragraphInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphInternal" th:remove="tag">
			<div class="mt-4" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* referenceBox */-->
	<div th:fragment="referenceBox(title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: referenceBoxInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="referenceBoxInternal" th:remove="tag">
			<div class="text-dark mt-4">
				<th:block th:if="${!#strings.isEmpty(titleString)}"><code  class="text-dark" th:text="'[' + ${titleString} + ']'"></code></th:block>
				<div class="border ps-3 pe-3" style="background-color: #ffffe0">
					<pre class="mb-0"><code><div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div></code></pre>
				</div>
			</div>
		</div></th:block>
	</div>

	<!--/* box. space enclosed by a frame. */-->
	<div th:fragment="box(boxContents, title, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: boxInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="boxInternal" th:remove="tag">
			<div class="border mt-3">
				<div class="m-3">
					<th:block th:if="${!#strings.isEmpty(titleString)}">
						<div class="fs-4 mb-3" th:text="${titleString}"></div>
					</th:block>
					<th:block th:if="${!#strings.isEmpty(messageString)}">
						<div style="white-space: pre-wrap;" th:text="${messageString}"></div>
					</th:block>

					<th:block th:replace="${boxContents}" />

				</div>
			</div>
		</div></th:block>
	</div>
	
	<!--/* freeSpace */-->
	<!--/* You can input free text / html. It is used for commonize color and font. */-->
	<div th:fragment="freeSpace(freeSpaceContent, options)" th:remove="tag">
 		<div th:replace="~{ :: internalMessageDisplayCommonComponent(~{ :: freeSpaceInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="freeSpaceInternal" th:remove="tag">
				<th:block th:replace="${freeSpaceContent}" />
		</div></th:block>
	</div>

	<!--/* 
		### table components.
	 */-->

	<!--/* internal common display message component */-->
	<!--/* 
		'title' and 'message' can be the key to the message.properties or item_names.properties, 
		or if it does not exist in properties files, it shows the string directly.
	*/-->
	<div th:fragment="internalTableCommonComponent(contents, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentTableCommonComponent}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentTableCommonComponent" th:remove="tag">
			<th:block th:replace="${contents}" />
		</div></th:block>
	</div>
	
	<!--/* simple table header */-->
	<div th:fragment="simpleTableHeader(labels, options)" th:remove="tag">
 		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentSimpleTableHeader}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSimpleTableHeader" th:remove="tag">
			<thead th:id="${componentId}" class="text-white bg-color-tbl-header bg-gradient  align-middle">
				<tr>
					<th:block th:each="label : ${labels}">
						<th scope="col" class="text-center" th:utext="${@msgUtil.get(#locale, label)}"></th>
					</th:block>
				</tr>
			</thead>
		</div></th:block>
	</div>
 	
	<!--/* simple table lines from lines of cell elements */-->
	<div th:fragment="simpleTableTrsFromLines(linesOfCellElements, options)" th:remove="tag">
		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentSimpleTableTrsFromLines}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSimpleTableTrsFromLines" th:remove="tag">
			<tr th:id="${componentId}" th:each="cellElements : ${linesOfCellElements}">
				<th:block th:each="cellElement : ${cellElements}">
					<th:block th:with="alignment=${cellElement[0]}, string=${cellElement[1]}, 
							rowspan=${#lists.size(cellElement) == 2 ? 1 : cellElement[2]},
							colspan=${#lists.size(cellElement) == 2 ? 1 : cellElement[3]},
							">
						<td class="align-middle fs-6 text-dark" th:classappend="${'text-' + alignment}" style="white-space: pre-wrap;"
								th:text="${@msgUtil.get(#locale, string)}" th:rowspan="${rowspan}" th:colspan="${colspan}"></td>
					</th:block>
				</th:block>
			</tr>
		</div></th:block>
	</div>
	
	<!--/* simple table body from lines of cell elements. */-->
	<!--/*
		Each cellElement in a table is expressed in the form of an array :  {alignment, string} or {alignment, string, rowspan, colspan}
		where alignment selections are 'start', 'center' and 'end'.
		cellElements (= cell elements which form a line of a table) is an array of 'cellElement's, which means cellElements is a 2-dimensional array.
		linesOfCellElements is an array of cellElements, which means linesOfCellElements is 3-dimensional array.
	 */-->
	<div th:fragment="simpleTableBodyFromLines(linesOfCellElements, options)" th:remove="tag">
		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentSimpleTableBodyFromLines}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSimpleTableBodyFromLines" th:remove="tag">
			<tbody th:id="${componentId}">
				<div th:replace="~{ :: simpleTableTrsFromLines(${linesOfCellElements}, ${options})}"></div>
			</tbody>
		</div></th:block>
 	</div>
	
	<!--/* simple table body from an array of lines of cell elements. */-->
	<!--/* 
		simpleTableBodyFromLines creates table from one 'linesOCellElements', 
		but sometimes you want to create a table from multiple 'linesOfCellElements', 
		for example table lines have a common part. 
	 */-->
	<div th:fragment="simpleTableBodyFromArrayOfLines(arrayOfLinesOfCellElements, options)" th:remove="tag">
		<div th:replace="~{ :: internalTableCommonComponent(~{ :: fragmentSimpleTableBodyFromArrayOfLines}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSimpleTableBodyFromArrayOfLines" th:remove="tag">
			<tbody th:id="${componentId}">
				<th:block th:each="linesOfCellElements : ${arrayOfLinesOfCellElements}">
					<div th:replace="~{ :: simpleTableTrsFromLinesOfCellElements(${linesOfCellElements}, ${options})}"></div>
				</th:block>
			</tbody>
		</div></th:block>
 	</div>

	<!--/* 
		### dynamic message displaying components.
	 */-->
	
	<!--/* speech balloon: chat style message component. */-->
	<!--/* 
		special thanks to: https://stand-4u.com/css/fukidashi.html
	 */-->
	<div  th:fragment="speechBalloon(itemPropertyPath, isMySpeech, isSelectable, name, timestamp, message, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentSpeechBalloon}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentSpeechBalloon" th:remove="tag">
			<!--/* Add space character when the input string is blank. */-->
			<div th:classappend="'balloon_' + ${isMySpeech ? 'r' : 'l'}" th:with="message=${message == null || message == '' ? '&nbsp;' : message}">
				<div class="faceicon" th:if="${!isMySpeech}">
					<img th:src="@{/images/speech-balloon-account-icon.png}" alt="" />
				</div>
				<div>
					<div class="name" th:if="${!isMySpeech}" th:text="${name}"></div>
					<div th:classappend="${'says' + (isSelectable ? '-selectable' : '')}" th:id="${itemPropertyPath}"></div>
					<div class="name mt-1" th:style="${'font-size: 60%; ' + (isMySpeech ? '' : 'display: flex; align-items: flex-end;')}">
					<span th:style="${isMySpeech ? 'margin-left: auto;' : ''}" th:text="${timestamp}"></span>
				</div>
				<input type="hidden" th:id="${itemPropertyPath + '_hidden'}" th:value="${message}" />
				<script type="text/javascript">
					document.getElementById('[[${itemPropertyPath}]]').innerText = document.getElementById('[[${itemPropertyPath}]]' + '_hidden').value;
				</script>
			</div>
		</div></th:block>
	</div>
	
	<!--/* 
		### shape components.
	 */-->
	
	<!--/* hr */-->
	<div th:fragment=horizontalLine(options) th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentHorizontalLine}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentHorizontalLine" th:remove="tag">
			<hr class="mt-4 mb-4">
		</div></th:block>
	</div>

	<!--/* 
		### navbar components.
	 */-->
	
	<!--/* internal common navBar component */-->
	<div th:fragment="internalNavBarCommonComponent(contents, label, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentNavBarCommonComponent}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarCommonComponent" th:remove="tag">
			<th:block th:with="labelString=${@msgUtil.get(#locale, '__${label}__')}">
			<th:block th:replace="${contents}" />
		</div></th:block>
	</div>
	
	<!--/* navBarMenu: A menu link (not dropdown) placed on navigation bars. */-->
	<div th:fragment="navBarMenuItem(href, label, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavBarCommonComponent(~{ :: fragmentNavBarMenuItem}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarMenuItem" th:remove="tag">
			<li th:id="${componentId}" style="margin-left: 20px">
				<a class="nav-link" th:href="${href}" th:text="${labelString}"></a>
			</li>
		</div></th:block>
	</div>
	
	<!--/* navBarMenu: A menu link (not dropdown) placed on navigation bars. */-->
	<div th:fragment="navBarSubMenu(label, menuItems, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavBarCommonComponent(~{ :: fragmentNavBarSubMenu}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarSubMenu" th:remove="tag">
			<li th:id="${componentId}" style="margin-left: 20px" class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
						data-bs-toggle="dropdown" aria-expanded="false" th:text="${labelString}"></a>
				<ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown"
						th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
						+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)}">
						<th:block th:replace="${menuItems}" />
				</ul>
			</li>
		</div></th:block>
	</div>

	<!--/* navBarDropDownMenuItem */-->
	<div th:fragment="navBarDropDownMenuItem(href, label, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavBarCommonComponent(~{ :: fragmentNavBarDropDownMenuItem}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarDropDownMenuItem" th:remove="tag">
			<li th:id="${componentId}"><a class="dropdown-item" th:href="${href}" th:text="${labelString}"></a></li>
		</div></th:block>
	</div>

	<!--/* navBarDropDownMenuDivider */-->
	<div th:fragment="navBarDropDownMenuDivider(options)" th:remove="tag">
		<div th:replace="~{ :: internalNavBarCommonComponent(~{ :: fragmentNavBarDropDownMenuDivider}, '', ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarDropDownMenuDivider" th:remove="tag">
			<li th:id="${componentId}"><hr class="dropdown-divider"></li>
		</div></th:block>
	</div>

	<!--/* navBarDropDownMenuGroupLabel */-->
	<!--/* 
		It's used when you want to put a classification label. 
		It's supposed to be placed at the top or right after the divider.
	*/-->
	<div th:fragment="navBarDropDownMenuGroupLabel(label, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavBarCommonComponent(~{ :: fragmentNavBarDropDownMenuGroupLabel}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarDropDownMenuGroupLabel" th:remove="tag">
			<li th:id="${componentId}" class="mb-1"><small>
				<div class="ms-3" style="font-weight: bold" th:text="${'&lt; &nbsp;' + labelString + '&nbsp; &gt;'}"></div>
			</small></li>
		</div>
	</div>

	<!--/* navBarDropDownSubMenu */-->
	<div th:fragment="navBarDropDownSubMenu(label, menuItems, options)" th:remove="tag">
		<div th:replace="~{ :: internalNavBarCommonComponent(~{ :: fragmentNavBarDropDownSubMenu}, ${label}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentNavBarDropDownSubMenu" th:remove="tag">
			<li th:id="${componentId}">
				<a class="dropdown-item" href="#">
					<div style="text-align: left; float: left;" th:text="${labelString}"></div>
					<div style="text-align: right;" th:text="${options.contains('direction=left') ? '&ltrif;' : '&rtrif;'}">︎</div>
				</a>
				<ul class="dropdown-menu dropdown-submenu dropdown-menu-dark bg-gradient bg-primary"
						th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
						+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)
						+ ' ' + (options.contains('direction=left') ? 'dropdown-submenu-left' : '')}">
					<th:block th:replace="${menuItems}" />
				</ul>
			</li>
		</div></th:block>
	</div>
	 
	<!--/* 
		### server message displaying components.
	 */-->
	 
	<!--/* server messages */-->
	<div th:fragment="messages(options)" th:remove="tag" th:if="${!(noMessages != null && noMessages)}">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentMessages}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentMessages" th:remove="tag">
			<div class="mt-5 mb-5">
				<!-- messages from url parameter -->
				<div class="all-error-messages-list-wrapper text-danger">
					<div class="bg-color-msg-error-bg p-2 rounded-1" 
							th:if="${param.error != null or param.logoutDone != null or param.accessDenied != null or param.notFound != null}">
						<div th:replace="~{ :: freeSpace(~{ ::free-space-login-messages}, '')}"></div>
					</div>
				</div>
				<th:block th:if="false"><div th:fragment="free-space-login-messages" th:remove="tag">
					<div th:if="${param.error}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.error')}"></div>
					<div th:if="${param.logoutDone}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.logoutDone')}"></div>
					<div th:if="${param.accessDenied}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.accessDenied')}"></div>
					<div th:if="${param.notFound}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.notFound')}"></div>
				</div></th:block>
				<!-- messages from ${messagesBean} -->
				<div th:object="${messagesBean}">
					<div class="bg-color-msg-success-bg p-2 rounded-1" th:if="${param.keySet().contains('success') || messagesBean.needsSuccessMessage}">
						<div class="text-success" th:if="${param.success}" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.success')}"></div>
						<div class="text-success" th:if="*{needsSuccessMessage}" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.success')}"></div>
					</div>
					<div class="all-error-messages-list-wrapper text-danger">
						<div class="bg-color-msg-error-bg p-2 rounded-1" th:if="*{errorMessages != null && errorMessages.size() > 0}">
							<!--/* in the case of showing item related message here */-->
							<th:block th:if="${showsMessagesLinkedToItemsAtTheTop}">
								<div class="all-error-messages-list-ul">
									<div th:replace="~{ :: internalDisplayMessages(*{errorMessages})}"></div>
								</div>
							</th:block>
							<!--/* in the case of showing item related message at each item */-->
							<th:block th:if="${showsMessagesLinkedToItemsAtEachItem}">
								<ul class="all-error-messages-list-ul">
									<!--/* showing non-item-related messages */-->
									<th:block th:if="*{errorMessagesNotLinkedToItems.size() > 0}">
										<div th:replace="~{ :: internalDisplayMessages(*{errorMessagesNotLinkedToItems})}"></div>
									</th:block>
									<!--/* showing a message that says there's an error at some of the items */-->
									<th:block th:if="*{errorMessagesLinkedToItems.size() > 0}">
										<div th:replace="~{ :: internalDisplayMessages(${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.messagesLinkedToItemsExist')})}"></div>
									</th:block>
								</ul>
							</th:block>
						</div>
					</div>
				</div>
			</div>
		</div></th:block>
	</div>

	<!--/* message displaying internal common component */-->
	<div th:fragment="internalDisplayMessages(errorMessages)" th:remove="tag">
		<table th:each="message : ${errorMessages}" style="width: 100%;">
			<tr>
				<td style="vertical-align:top; width: 20px"><div style="margin-left: 10px; margin-right: 10px;">- </div></td>
				<td colspan="2"><div class="all-error-messages-list-li" style="white-space: pre-wrap">[[
						${#strings.contains(message, #strings.unescapeJava('\n\n')) ? 
						#strings.substring(message, 0, #strings.indexOf(message, #strings.unescapeJava('\n\n'))) : message}]]</div></td>
			</tr>
			<!--/* 
				subMessage feature.
				See the following for error reasons:\n\nreason1: xxx\nreason2: xxx
				-> 
				- See the following for error reasons:
				  - reason1: xxx
				  - reason2: xxx
			 */-->
			<th:block th:if="${#strings.contains(message, #strings.unescapeJava('\n\n'))}">
				<th:block th:each="subMessage : ${#strings.arraySplit(#strings.substring(message, #strings.indexOf(message, #strings.unescapeJava('\n\n'))), #strings.unescapeJava('\n'))}">
					<tr>
						<td></td>
						<td style="vertical-align:top; width: 10px"><div style="margin-right: 10px">- </div></td>
						<td><div class="all-error-messages-list-li" style="white-space: pre-wrap">[[${subMessage}]]</div></td>
					</tr>
				</th:block>
			</th:block>
		</table>
	</div>
	
	<!--/* button */-->
	<div th:fragment="button(id, label, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentButton}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentButton" th:remove="tag">
		<!--/* 
			<button th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" class="btn btn-color-btn text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:text="${label}"></button>
		 */-->
		</div></th:block>
	</div>



	<!--/* 
		###
		### components available in general form pages
		### pages using general forms (like edit, searchList) are included.
		###
	 */-->

	<!--/* 
		### form
	 */-->

	<!--/* generalForm */-->
	<div th:fragment="generalForm(formContent, topSpaceContent, bottomSpaceContent
			, formMethod, multipart, subFunction, versionFieldName, versionInitialValue, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentGeneralForm}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentGeneralForm" th:remove="tag">
			<th:block th:with="subFunction=${subFunction == null ? '' : subFunction}">
				<th:block th:with="htmlFormName=${subFunction + (subFunction == '' ? 'form' : 'Form')},
						javaFormName=${function + #strings.capitalize(subFunction) + 'Form'}">
	
					<th:block th:replace="${topSpaceContent}" />
	
					<!--/* issue#156: Since the error message is hard to understand when ${__${javaFormName}__} == null, understandable message output procedure is added. */-->
					<th:block th:if="${__${javaFormName}__} == null"
							th:with="msg=${'Form not found in model. Form name: ' + javaFormName + '. 
									The reason can be: Form with the name not defined; 
									Form is defined but not used (not set in the generics parameter of the controller definition sentence);'}">
						[[${@exUtil.systemError(msg)}]]
					</th:block>
	
					<!--/* subFunction, ctrlSubFunctionの挙動については#454参照。  */-->
					<form th:name="${htmlFormName}" th:id="${htmlFormName}" 
							th:method="${formMethod == null || formMethod == '' ? 'post' : formMethod}"
							th:enctype="${multipart == null || multipart == false ? 'application/x-www-form-urlencoded' : 'multipart/form-data'}"
							th:action="@{/} + ${#strings.replace(loginState, '-', '/')} + '/' + ${functionKindsPathString} + ${function} + ${(ctrlSubFunction == null ? (subFunction == null || subFunction == '' ? '' : '/' + subFunction) : (ctrlSubFunction == '' ? '' : '/' + ctrlSubFunction)) + '/action'}"
							th:object="${__${javaFormName}__}">
						<div th:replace="~{ :: token('')}"></div>
						<!--/* controller側からmodelに渡すformm名が間違えている場合にいつもここでエラーになるが、設定したform名が取得できずdebugしているので、
						       赤字でエラー表示しつつform名を出力 */-->
						<h1 style="color: red" th:if="${__${function + #strings.capitalize(subFunction) + 'Form'}__} == null">
							form: [[${function + #strings.capitalize(subFunction) + 'Form'}]] is null.
						</h1> 
						
						<!--/* confirmedWarningsで、formの外からボタンクリックが必要なためform名を保持しておく */-->
						<input type="hidden" name="htmlFormName" th:value="${htmlFormName}">
						<input type="hidden" name="confirmedWarnings" th:data-html-form-name="${htmlFormName}" th:value="*{confirmedWarnings}">
			 			<input type="hidden" name="submitOnChangeToRefresh">
						<div th:replace="~{ :: version(${rootRecordName}, ${versionFieldName}, ${versionInitialValue}, '')}"></div>
						<th:block th:replace="${formContent}" />
			
						<div th:replace="~{ :: internalWarnMessage('')}"></div>
	
		 			</form>
					
					<th:block th:replace="${bottomSpaceContent}" />
			
				</th:block>
			</th:block>
		</div></th:block>
	</div>

	<!--/* internal warn message part */-->
	<div th:fragment="internalWarnMessage(options)" th:remove="tag">
		<div th:object="${messagesBean}">
			<th:block th:if="*{warnMessage != null}">
				<input type="hidden" name="warnMessage" th:data-button-name="*{warnMessage.buttonName}" th:data-msg-id="*{warnMessage.messageId}" th:value="*{warnMessage.message}">
				<script>
					var bl = confirm(this.form.elements['warnMessage'].value);
					var obj = this.form.elements['confirmedWarnings'];
					if (bl) {
						obj.value = obj.value + "," + this.form.elements['warnMessage'].dataset.msgId;
						
						const buttonName = this.form.elements['warnMessage'].dataset.buttonName;
						if (typeof buttonName === "undefined") {
							buttonName = "";
						}
						
						if (buttonName == "") {
							this.form.submit();

						} else {
							var btn = this.form.elements[buttonName];
							btn.click();
						}
						
					} else {
						obj.value = "";
					}
				</script>
			</th:block>
		</div>
	</div>

	<!--/* 
		### input components
	 */-->
	
	<!--/* internal common input component. */-->
	<!--/* options: 
			- id		arbitrary	specifies 'id' attribute of the html component. As default "htmlFormName + '.' + propertyPath"
			- width		arbitrary	specifies width of the html component. values can be 'full' or 'half'.
	*/-->
	<div th:fragment="internalInputCommonComponent(itemPropertyPath, contents, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentInputCommonComponent}, false, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputCommonComponent" th:remove="tag">
			<th:block th:with="propertyPathClass=${itemPropertyPath.contains('.') 
					? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
					propertyPathField=${itemPropertyPath.contains('.') 
					? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath},
					itemKindIdClass=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : rootRecordName}">
				<th:block th:with="propertyPath=${propertyPathClass + '.' + propertyPathField}, itemKindId=${itemKindIdClass + '.' + propertyPathField}">
					<th:block th:with="inputValue=*{__${propertyPath}__}, inputName=${propertyPath},
							inputId=${@optUtil.hasKey(options, 'id') ? @optUtil.getValue(options, 'id') : (htmlFormName + '.' + propertyPath)}">
						<div th:id="${componentId}" class="mb-4" th:classappend="${@optUtil.hasKey(options, 'width') and @optUtil.getValue(options, 'width') == 'full'} 
								? 'col-12' : (${@optUtil.hasKey(options, 'width') and @optUtil.getValue(options, 'width') == 'half'}
								? ' col-md-6' : 'col-xl-3 col-lg-4 col-md-6')">
	
							<!--/* label */-->
							<th:block th:with="displayName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${itemPropertyPath}__')}">
									<!--/* isPrincipalStringは、#authentication.principalが、loginしている場合は複数項目を格納するbeanなのに、loginしていない場合はStringといういやらしい仕様なので、String可動化をチェックしている */-->
								<label th:for="${inputId}" class="form-label text-dark" th:with="isPrincipalString=${#authentication.principal.class.name == 'java.lang.String'}">
									[[${@msgUtil.get(#locale, '__${displayName}__')}]]<span class="text-danger" th:if="*{__${rootRecordName}__.isNotEmpty('__${itemPropertyPath}__', '__${loginState}__', '__${isPrincipalString ? '' : #authentication.principal.authorities}__')}">&nbsp;*</span>
								</label>
							</th:block>
							
							<!--/* content */-->
							<th:block th:replace="${contents}" />
		
							<!--/* field messages */-->
							<th:block th:if="${showsMessagesLinkedToItemsAtEachItem}">
								<div class="text-danger" th:if="${messagesBean.getErrorMessages('__${propertyPath}__') != null}"
									th:classappend="${@optUtil.isForSwitch(options) ? 'mt-1' : ''}"
									th:each="message : ${messagesBean.getErrorMessages('__${propertyPath}__')}">[[${message}]]</div>
							</th:block>
							
						</div>
					</th:block>
				</th:block>
			</th:block>	
		</div></th:block>
	</div>
	
	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalInputTextComponent(itemPropertyPath, type, needsMaxLength, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputText}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputText" th:remove="tag">
			<input th:type="${type}" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}"
					th:maxlength="${@optUtil.isReadOnly(options) || type == 'hidden'} ? '' : *{__${propertyPathClass}__.getStringLength('__${propertyPathField}__')}"
					th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
					th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<div th:fragment="inputText(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputTextComponent(${itemPropertyPath}, 'text', true, ${options})}"></div>
	</div>
	
	<!--/* textbox(password) */-->
	<div th:fragment="inputPassword(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputTextComponent(${itemPropertyPath}, 'password', true, ${options})}"></div>
	</div>

	<!--/* hidden */-->
	<div th:fragment="inputHidden(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentInputHidden}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputHidden" th:remove="tag">
			<div th:replace="~{ :: internalInputTextComponent(${itemPropertyPath}, 'hidden', false, ${options})}"></div>
		</div></th:block>
	</div>
	
	<!--/* inputNumber */-->
	<div th:fragment="inputNumber(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputNumber}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputNumber" th:remove="tag">
			<th:block th:with="needsCommas=*{__${rootRecordName}__.needsCommas('__${rootRecordName}__', '__${itemPropertyPath}__')}">
				<input th:type="text" th:id="${inputId}" th:name="${inputName}"
						th:value="${(needsCommas && @strUtil.isNumberFormat(inputValue)) ? #numbers.formatDecimal(#strings.replace(inputValue, ',', ''), 1, 'COMMA', 0, 'POINT') : inputValue}"
						th:maxlength="${@optUtil.isReadOnly(options)} ? '' : *{__${propertyPathClass}__.getStringLength('__${propertyPathField}__')}"
						class="text-end"
						th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
						th:readonly="${@optUtil.isReadOnly(options)}">
				<th:block th:if="${needsCommas}">
					<script th:inline="javascript">
						addNumberFormatFunction(/*[[${rootRecordName + '.' + itemPropertyPath}]]*/);
					</script>
				</th:block>
			</th:block>
		</div></th:block>
	</div>

	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalInputDateTime(itemPropertyPath, type, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputDateTime}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputDateTime" th:remove="tag">
			<input th:type="${type}" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<!--/* textbox(month) */-->
	<div th:fragment="inputYearMonth(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputDateTime(${itemPropertyPath}, 'month', ${options})}"></div>
	</div>

	<!--/* textbox(date) */-->
	<div th:fragment="inputDate(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputDateTime(${itemPropertyPath}, 'date', ${options})}"></div>
	</div>

	<!--/* textbox(time) */-->
	<div th:fragment="inputTime(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputDateTime(${itemPropertyPath}, 'time', ${options})}"></div>
	</div>

	<!--/* textarea */-->
 	<div th:fragment="inputTextArea(itemPropertyPath, options)" th:remove="tag">
 		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputTextArea}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputTextArea" th:remove="tag">
			<textarea th:id="${inputId}" th:name="${inputName}" th:text="${inputValue}"
				th:maxlength="*{__${propertyPathClass}__.getStringLength('__${propertyPathField}__')}" 
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
				th:readonly="${@optUtil.isReadOnly(options)}" rows="3">
			</textarea>
		</div></th:block>
	</div>

	<!--/* checkbox (switch) */-->
	<div th:fragment="inputSwitch(itemPropertyPath, options)" th:remove="tag">
 		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputSwitch}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputSwitch" th:remove="tag">
			<div class="form-check form-switch mt-2">
				<th:block th:if="${@optUtil.isReadOnly(options)}">
					<input type="hidden" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}">
				</th:block>
				<div>
					<input type="hidden" th:name="${@optUtil.isReadOnly(options) ? '' : inputName}" value="off">
					<input th:id="${inputId}" th:name="${@optUtil.isReadOnly(options) ? '' : propertyPath}"
						class="form-check-input align-bottom mb-1" type="checkbox" 
						th:checked="${inputValue}"
						th:classappend="${messagesBean.isValid(propertyPath)}"
						th:disabled="${@optUtil.isReadOnly(options)}">
				</div>
			</div>
		</div></th:block>
	</div>
	 
	<!--/* checkbox */-->
	<div th:fragment="inputCheckboxes(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputCheckboxes}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputCheckboxes" th:remove="tag">
			<div class="form-check mt-2" th:each="option : *{__${propertyPath + 'List'}__}">
				<th:block th:with="optionId=${option[0]},optionLabel=${option[1]},optionOptions=${option.length == 2 ? '' : option[2]}">
					<input th:id="${optionId}" class="form-check-input align-bottom mb-1" type="checkbox" 
						th:name="${@optUtil.isReadOnly(optionOptions) ? '' : propertyPath}" 
						th:checked="*{__${propertyPath}__ == null ? false : (propertyPath + '.contains(''' + optionId + ''')')}"
						th:classappend="${messagesBean.isValid(propertyPath)}"
						th:disabled="${@optUtil.isReadOnly(optionOptions)}"
						th:value="${optionId}">
					<label class="form-check-label text-dark" th:for="${optionId}" th:text="${optionLabel}"></label>
					<th:block th:if="${@optUtil.isReadOnly(optionOptions)}">
						<input type="hidden" th:name="${propertyPath}" th:value="${optionId}">
					</th:block>
				</th:block>
			</div>
		</div></th:block>
	</div>

	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalInputSelect(itemPropertyPath, pairs, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ ::fragmentInputComponentSelect}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputComponentSelect" th:remove="tag">
			<!--/* selectにはreadonlyが存在しないため、disabledを使用 */-->
			<th:block th:if="${@optUtil.isReadOnly(options)}">
				<input type="hidden" th:id="${@optUtil.hasKey(options, 'id') ? propertyPath : null}" th:name="${propertyPath}" th:value="${inputValue}">
			</th:block>
			<select th:id="${inputId}" th:name="${@optUtil.isReadOnly(options) ? '' : propertyPath}"
					class="form-select" th:classappend="${messagesBean.isValid(propertyPath)}"
					th:disabled="${@optUtil.isReadOnly(options)}"
					th:data-submit-on-change-to-refresh="${@optUtil.hasKey(options, 'submitOnChangeToRefresh')}"
					th:data-html-form-name="${htmlFormName}"
					onchange="if (this.dataset.submitOnChangeToRefresh == 'true') {document.forms[this.dataset.htmlFormName].elements['submitOnChangeToRefresh'].value = 'true'; this.form.submit();}">
				<option th:if="${@optUtil.needsEmptyOption(options)}" th:selected="${inputValue == null || inputValue == ''}"></option>
				<th:block th:each="pair : ${pairs}">
					<option th:value="${pair[0]}" th:selected="${pair[0] == inputValue}">[[${pair[1]}]]</option>
				</th:block>
			</select>
		</div></th:block>
	</div>
	
	<div th:fragment="inputSelect(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputSelect(${itemPropertyPath}, *{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__()}, ${options})}"></div>
	</div>

	<!--/* 
		- options:
		  - including: 指定したEnum要素のみをプルダウンに表示。'include=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - excluding: 指定したEnum要素以外をプルダウンに表示。'exclude=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - firstCharOfCodeEqualTo: codeの一文字目が等しい場合にtrue
		  - firstCharOfCodeLessThanOrEqualTo: codeの一文字目をascii codeの大小で比較
		  - firstCharOfCodeGreaterThanOrEqualTo: codeの一文字目をascii codeの大小で比較
	 */-->
	<div th:fragment="inputSelectFromEnum(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputSelect(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>
	
	<div th:fragment="inputSelectWithLocale(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputSelect(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>
	
	<!--/* component for file upload */-->
	<div  th:fragment="inputFile(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentInputFile}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputFile" th:remove="tag">
			<input class="form-control" type="file" th:id="${inputId}" th:name="${propertyPath}" 
					th:classappend="${messagesBean.isValid(propertyPath)}">
		</div></th:block>
	</div>
	
	<!--/* component for file upload */-->
	<div  th:fragment="inputTakenPhotoMobile(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalInputCommonComponent(${itemPropertyPath}, ~{ :: fragmentInputTakenPhotoMobile}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInputTakenPhotoMobile" th:remove="tag">
			<input class="form-control" th:classappend="${messagesBean.isValid(propertyPath)}" 
					type="file" th:name="${propertyPath}"  th:id="${inputId}" accept="image/*" capture="user">
		</div></th:block>

	<!--/* for PC
		<video id="video" width="320" height="240" autoplay muted></video>
		<canvas id="canvas" width="320" height="240"></canvas>
		<img id="photo" src="#" alt="taken photo">
		<input type="hidden" id="takenPhoto" name="input.inputTakenPhoto" th:value="*{input.inputTakenPhoto}">
		<div class="mt-2"></div>
		<button id="allowance" type="button" style="vertical-align: bottom;" class="btn btn-sm btn-color-btn text-white bg-gradient">撮影画面表示</button>
		<button id="capture" type="button" style="vertical-align: center;" class="btn btn-sm btn-color-btn text-white bg-gradient">撮影</button>
		<button id="recapture" type="button" style="vertical-align: bottom;" class="btn btn-sm btn-color-btn text-white bg-gradient">再撮影</button>
	
		<script>
			const video = document.getElementById('video');
			const canvas = document.getElementById('canvas');
			const photo = document.getElementById('photo');
			const hidden = document.getElementById('takenPhoto');
			const allowanceButton = document.getElementById('allowance');
			const captureButton = document.getElementById('capture');
			const recaptureButton = document.getElementById('recapture');
			let stream;
	
			video.style.display = 'none';
			canvas.style.display = 'none';
			photo.style.display = 'none';
			captureButton.style.display = 'none';
			recaptureButton.style.display = 'none';
			
			if (hidden.value != "") {
				photo.style.display = 'flex';
				photo.setAttribute('src', hidden.value);
			}
			
			// allowanceボタンが押された時の処理
			allowanceButton.addEventListener('click', function() {
				// カメラへのアクセス許可を要求
				navigator.mediaDevices.getUserMedia({ video: true })
					.then(function(mediaStream) {
						stream = mediaStream;
						video.srcObject = stream;
						video.onloadedmetadata = function(e) {
						  video.play();
						};
	
						// 撮影画面表示の変更
						video.style.display = 'flex';
						photo.style.display = 'none';
						// ボタンの表示を変更
						allowanceButton.style.display = 'none';
						captureButton.style.display = 'flex';
						
						// canvasから画像データを取得
						photo.setAttribute('src', '');
						hidden.value = '';
					})
					.catch(function(err) {
						console.log("カメラへのアクセスエラー: " + err);
					});
			});
	
			// 撮影ボタンがクリックされた時の処理
			captureButton.addEventListener('click', function() {
				const context = canvas.getContext('2d');
				context.drawImage(video, 0, 0, canvas.width, canvas.height);
				 
				// 撮影画面表示の変更
				video.style.display = 'none';
				photo.style.display = 'flex';
				// ボタンの表示を変更
				captureButton.style.display = 'none';
				recaptureButton.style.display = 'inline-block';
				// canvasから画像データを取得
				photo.setAttribute('src', canvas.toDataURL('image/jpeg'));
				hidden.value = canvas.toDataURL('image/jpeg');
			});
	
			// 再撮影ボタンがクリックされた時の処理
			recaptureButton.addEventListener('click', function() {
				const context = canvas.getContext('2d');
				context.drawImage(video, 0, 0, canvas.width, canvas.height);

				// 撮影画面表示の変更
				video.style.display = 'flex';
				photo.style.display = 'none';
				// ボタンの表示を変更
				captureButton.style.display = 'inline-block';
				recaptureButton.style.display = 'none';
				
				// canvasから画像データを取得
				photo.setAttribute('src', '');
				hidden.value = '';
			});
	  </script> */-->
	</div>
	
	<!--/* 
		### general form button.
	 */-->

	<!--/* internal common navBar component. */-->
	<div th:fragment="internalButtonCommonComponent(contents, options)" th:remove="tag">
 		<div th:replace="~{ :: internalAllCommonComponent(~{ :: fragmentButtonCommonComponent}, true, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentButtonCommonComponent" th:remove="tag">
			<th:block th:replace="${contents}" />
		</div></th:block>
	</div>
	
	<!--/* common button */-->
	<div th:fragment="commonPrimaryButton(id, label, options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent(~{ :: fragmentCommonPrimaryButton}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentCommonPrimaryButton" th:remove="tag">
			<button type="submit" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" class="btn btn-color-btn text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:text="${label}"></button>
		</div></th:block>
	</div>

	<!--/* backButton */-->
	<div th:fragment="backButton(label, options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent(~{ :: fragmentBackButton}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentBackButton" th:remove="tag">
			<button type="submit" id="back" name="back" class="btn btn-color-btn text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:text="${label}"></button>
		</div></th:block>
	</div>
	
	<!--/* inter-button space */-->
	<span th:fragment="interButtonSpace(options)" th:remove="tag">
		<div th:replace="~{ :: internalButtonCommonComponent(~{ :: fragmentInterButtonSpace}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="fragmentInterButtonSpace" th:remove="tag">
			<span>&nbsp;&nbsp;&nbsp;</span>
		</div></th:block>
	</span>

	<!--/* 
		### general form hidden components
	 */-->

	<!--/*
		version.
		initialValueは、画面表示時から値を埋めておきたい場合（単票系の画面）とそうでない場合（一覧系画面）がある。
	 */-->
	<div th:fragment="version(rootRecordName, fieldName, initialValue, options)" th:remove="tag" th:with="id=${rootRecordName + '.' + (fieldName == null || fieldName == '' ? 'version' : fieldName)}">
		<input type="hidden" th:name="${id}" th:value="${initialValue}" />
	</div>

	<!--/* token。単純なものだが複数箇所で使用するので共通化。 */-->
	<div th:fragment="token(options)" th:remove="tag">
		<input type="hidden" name="transactionToken" th:value="${transactionToken}">
	</div>
	
	<!--/* zone offsetを取得する処理 */-->
	<div th:fragment="sendZoneOffset(options)" th:remove="tag">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<input type="hidden" id="zoneOffsetParams" th:data-url="@{/public/zoneOffset}">
		<script>
		$(function() {
			var offset = new Date().getTimezoneOffset();
			var url = document.getElementById('zoneOffsetParams').dataset.url;
			$.ajax(url + '?zoneOffset=' + offset,
				{
					type: 'get'
				}
			)
		});
		</script>
	</div>
	
	<!--/* 
		###
		### search components.
		###
	 */-->
	
	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="internalSearchCommonComponent(itemPropertyPath, contents, labelPostfix, options)" th:remove="tag">
		<th:block th:with="recordName=${itemPropertyPath.contains('.') ? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
				fieldName=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath}">
			<th:block th:with="id=${recordName + '.' + fieldName},value=*{__${recordName + '.' + fieldName}__}">
				<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
				
					<!--/* label */-->
					<th:block th:with="recordName=${itemPropertyPath.contains('.') ? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
							fieldName=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath}">
						<th:block th:with="labelRecordName=${#strings.contains(recordName, '.') ? #strings.substring(recordName, #strings.indexOf(recordName, '.') + 1) : recordName}">
							<label th:for="${id}" class="form-label text-dark" 
									th:with="labelFieldName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${itemPropertyPath}__')}">
								[[#{__${labelFieldName}__}]] [[${labelPostfix}]]
							</label>
						</th:block>
					</th:block>
		
					<th:block th:replace="${contents}" />
				</div>
			</th:block>
		</th:block>
	</div>
	
	<div th:fragment="searchText(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchCommonComponent(${itemPropertyPath}, ~{ ::searchTextInternal(${itemPropertyPath}, 
				${options})}, *{__${rootRecordName}__.getSearchPatternComment(#locale, '__${itemPropertyPath}__')}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchTextInternal(itemPropertyPath, options)" th:remove="tag">
			<input type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" th:value="${value}"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}"
				th:maxlength="${@optUtil.isReadOnly(options)} ? '' : *{__${recordName}__.getStringLength('__${fieldName}__')}"
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<div th:fragment="searchNumber(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchCommonComponent(${itemPropertyPath}, ~{ ::searchNumberInternal(${itemPropertyPath}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchNumberInternal(itemPropertyPath, options)" th:remove="tag">
			<input type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" th:value="${value}"
				class="text-end"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}"
				th:maxlength="${@optUtil.isReadOnly(options)} ? '' : *{__${recordName}__.getStringLength('__${fieldName}__')}"
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>
	 
	<div th:fragment="searchDate(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchCommonComponent(${itemPropertyPath}, ~{ ::searchDateInternal(${itemPropertyPath}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchDateInternal(itemPropertyPath, options)" th:remove="tag">
			<input type="date" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" th:value="${value}"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}" 
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<div th:fragment="searchSelect(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: searchComponentSelect(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__()}, ${options})}"></div>
	</div>
	
	<!--/* 
		- options:
		  - including: 指定したEnum要素のみをプルダウンに表示。'include=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - excluding: 指定したEnum要素以外をプルダウンに表示。'exclude=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - firstCharOfCodeEqualTo: codeの一文字目が等しい場合にtrue
		  - firstCharOfCodeLessThanOrEqualTo: codeの一文字目をascii codeの大小で比較
		  - firstCharOfCodeGreaterThanOrEqualTo: codeの一文字目をascii codeの大小で比較
	 */-->
	<div th:fragment="searchSelectFromEnum(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: searchComponentSelect(${itemPropertyPath}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(itemPropertyPath)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>
	
	<!--/* internal common component */-->
	<div th:fragment="searchComponentSelect(itemPropertyPath, pairs, options)" th:remove="tag">
		<div th:replace="~{ :: internalSearchCommonComponent(${itemPropertyPath}, ~{ ::searchSelectInternal}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchSelectInternal" th:remove="tag">
			<select class="form-select" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" 
					th:name="${id}"
					th:classappend="${messagesBean.isValid(id)}" 
					th:data-submit-on-change-to-refresh="${@optUtil.hasKey(options, 'submitOnChangeToRefresh')}"
					th:data-html-form-name="${htmlFormName}"
					onchange="if (this.dataset.submitOnChangeToRefresh == 'true') {document.forms[this.dataset.htmlFormName].elements['submitOnChangeToRefresh'].value = 'true'; this.form.submit();}">
				<option th:if="${@optUtil.needsEmptyOption(options)}" th:selected="${value == null || value == ''}"></option>
				<th:block th:each="pair : ${pairs}">
					<!--/* 通常の文字列だとpre-processingは不要だったのだが、booleanを処理しようとすると子hの形でないと認識されなかった */-->
					<option th:value="${pair[0]}" th:selected="${pair[0] == '__${value}__'}">[[${pair[1]}]]</option>
				</th:block>
			</select>
		</div></th:block>
	</div>
	
	<!--/* 
		### tableのsort, pagination, 表示行数の関連components。
	 */-->
	
	<!--/* sort, paging, 表示件数をまとめた機能  */-->
	<div th:fragment="sortPagingAndRecordsInScreen(form, options)" th:remove="tag">
		<input type="hidden" id="sortItem" name="sortItem" th:value="${form.sortItem}">
		<input type="hidden" id="direction" name="direction" th:value="${form.direction}">
		<input type="hidden" id="page" name="page" th:value="${form.page}">
		<input type="hidden" id="recordsInScreen" name="recordsInScreen" th:value="${form.recordsInScreen}">
		<input type="hidden" id="requestFromSearchForm" name="requestFromSearchForm" value="true">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-4 align-self-end">
					<div>[[${form.linesInScreen}]]</div>
				</div>
				<div class="col-md-4">
					<nav aria-label="Page navigation" th:if="${form.getPagerInfoList(#locale).size() > 0}">
						<ul class="pagination justify-content-center">
							<th:block th:each="pagerInfo : ${form.getPagerInfoList(#locale)}" th:object="${pagerInfo}" th:remove="tag">
								<li class="page-item" th:classappend="*{status}">
									<a th:if="*{isDisabled()}" class="page-link text-light" href="#" tabindex="-1" aria-disabled="true" th:text="*{displayString}"></a>
									<a th:if="*{!isDisabled()}" class="page-link" th:data-page="*{goToPage}" 
											href="#" onClick="listFromPage(this.dataset.page);" th:text="*{displayString}"></a>
								</li>
							</th:block>
						</ul>
					</nav>
				</div>
				<div class="col-md-4" style="text-align:right; padding-right: 0px">
					<div class="dropdown">
						<button class="text-white btn btn-color-paging-btn dropdown-toggle mb-3" 
								th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
								type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
							[[${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.label.recordsInScreen')}]]
						</button>
						<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(5)">5</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(10)">10</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(20)">20</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(50)">50</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(100)">100</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--/* 
		### search form button
	 */-->

	<!--/* searchButton */-->
	<div th:fragment="searchButton(options)" th:remove="tag">
		<button type="submit" name="search" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.search')}"></button>
	</div>

	<!--/* searchConditionClearButton */-->
	<div th:fragment="searchConditionClearButton(options)" th:remove="tag">
		<button type="submit" name="conditionClear" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.conditionClear')}"></button>
	</div>

	<!--/* 
		### search script
	 */-->
	 
	<!--/* javaScript for inline update button. inline update buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptForThSortable(options)" th:remove="tag">
		<script>
		function list(sortItem, direction) {
			document.getElementById("sortItem").value = sortItem;
			document.getElementById("direction").value = direction;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>	
	</div>
	
	<div th:fragment="scriptForRecordsInScreen(options)" th:remove="tag">
		<script>
		function listFromRecordsInScreen(recordsInScreen) {
			document.getElementById("recordsInScreen").value = recordsInScreen;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>
	</div>

	<div th:fragment="scriptForPagenation(options)" th:remove="tag">
		<script>
		function listFromPage(page) {
			document.getElementById("page").value = page;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>
	</div>
	
	<!-- /* 3つのscriptをまとめたもの。htmlパーツ側も結局セットにしたのでscript側もセットで使用することとする */ -->
	<div th:fragment="scriptForSortPagingAndRecordsInScreen(options)" th:remove="tag">
		<div th:replace="~{ :: scriptForThSortable('')}"></div>
		<div th:replace="~{ :: scriptForRecordsInScreen('')}"></div>
		<div th:replace="~{ :: scriptForPagenation('')}"></div>
	</div>



	<!--/* 
		###
		### list関連components.
		###
	 */-->

	<!--/* 
		### table header(th).
	 */-->

	<!--/* sort不可能なth。text-alignはcenter固定。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thText(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: thCustomizable(${itemPropertyPath}, 'center', ${options})}"></div>
	</div>
	
	<!--/* sort可能なth。text-alignはcenter固定。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thSortable(itemPropertyPath, options)" th:remove="tag">
		<div th:replace="~{ :: thCustomizable(${itemPropertyPath}, 'center', ${options + ',thSortable'})}"></div>
	</div>
	
	<!--/* カスタマイズ可能なsort可能なth。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thCustomizable(itemPropertyPath, position, options)" th:remove="tag">
		<th:block th:with="recordName=${itemPropertyPath.contains('.') ? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
				fieldName=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath}">
			<th:block th:with="id=${recordName + '.' + fieldName},labelFieldName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${itemPropertyPath}__')}">
				<th:block th:if="${@optUtil.hasThSortable(options)}">
					<th scope="col" th:class="'text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
							style="cursor: pointer" th:text="#{__${labelFieldName}__}" 
							th:data-item="${itemPropertyPath}" th:data-direction="${form.nextDirection('__${itemPropertyPath}__')}"
							onClick="list(this.dataset.item, this.dataset.direction);"></th>
		 		</th:block>
		 		<th:block th:if="${!@optUtil.hasThSortable(options)}">
					<th scope="col" th:class="'text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
							th:text="#{__${labelFieldName}__}"></th>
		 		</th:block>
	 	</th:block>
	</div>
	
	<!--/* ただのth。引数で表示するlabelを指定。 */-->
	<div th:fragment="thFreeText(label, options)" th:remove="tag">
		<th scope="col" class="text-center" th:text="${label}"></th>
	</div>
	
	<!--/* 
		### 以下、table内のinline componentsとjavascriptなど。
		### td系（ただしボタンを除く）は、その外でth:with="deleted=true"と与えると、文字が薄くなり削除されたっぽい効果がつく。
	 */-->
	
	<!--/* td readOnly text */-->
	<div th:fragment="tdReadOnlyText(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(itemPropertyPath)}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly number */-->
	<div th:fragment="tdReadOnlyNumber(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(itemPropertyPath)},
				needsCommas=*{needsCommas('__${rootRecordName}__', '__${itemPropertyPath}__')}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${((needsCommas && @strUtil.isNumberFormat(value)) ? #numbers.formatDecimal(value, 1, 'COMMA', 0, 'POINT')
					: value)}, 'right', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly fixed length */-->
	<div th:fragment="tdReadOnlyFixedLength(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(itemPropertyPath)}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'center', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly free text */-->
	<div th:fragment="tdReadOnlyFreeText(value, options)" th:remove="tag">
		<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
	</div>
	
	<!--/* td readOnly free fixed length */-->
	<div th:fragment="tdReadOnlyFreeFixedLength(value, options)" th:remove="tag">
		<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'center', ${options})}"></div>
	</div>
	
	<!--/* td readOnly enum text */-->
	<div th:fragment="tdReadOnlyEnumText(itemPropertyPath, options)" th:remove="tag">
		<th:block th:with="value=${rec.get__${#strings.capitalize(itemPropertyPath)}__Name(#locale)}">
			<div th:replace="~{ :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
		</th:block>
	</div>

	<!--/* td readOnly customizable */-->
	<div th:fragment="tdReadOnlyCustomizable(value, position, options)" th:remove="tag">
		<td th:class="'align-middle fs-6 text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
				th:th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}"
				th:classappend="${(deleted != null && deleted) || @optUtil.isDeleted(options)} ? 'text-deleted' : 'text-dark'">
			<th:block th:if="${@optUtil.hasLinkUrl(options)}">
				<a th:href="${@optUtil.getLinkUrl(options)}" target="_blank">[[${value}]]</a>
			</th:block>
			<th:block th:if="${@optUtil.hasLinkUrl(options) == false}">
				[[${value}]]
			</th:block>
		</td>
	</div>
	
	<!--/* td readOnly checkbox */-->
	<div th:fragment="tdReadOnlyCheckbox(itemPropertyPath, options)" th:remove="tag">
		<td class="align-middle text-center" th:th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<input class="form-check-input align-bottom mb-1 " type="checkbox" th:checked="*{__${itemPropertyPath}__}" disabled>
		</td>
	</div>
	
	<!--/* inline input number */-->
	<div th:fragment="tdInputNumber(itemPropertyPath, idValue, options)" th:remove="tag">
		<td class="align-middle text-center" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<th:block th:with="recordName=${itemPropertyPath.contains('.') ? rootRecordName + '.' + itemPropertyPath.substring(0, itemPropertyPath.lastIndexOf('.')) : rootRecordName},
					fieldName=${itemPropertyPath.contains('.') ? itemPropertyPath.substring(itemPropertyPath.lastIndexOf('.') + 1) : itemPropertyPath}">
				<th:block th:with="id=${recordName + '.' + fieldName + '_' + idValue},value=${rec.getValue(itemPropertyPath)},
						needsCommas=*{needsCommas('__${rootRecordName}__', '__${itemPropertyPath}__')}">
					<input th:type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}"
							th:value="${(needsCommas && @strUtil.isNumberFormat(value)) ? #numbers.formatDecimal(#strings.replace(value, ',', ''), 1, 'COMMA', 0, 'POINT') : value}"
							class="text-end form-control-sm fs-6 text-dark"
							th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}" 
							th:readonly="${@optUtil.isReadOnly(options)}">
					<th:block th:if="${needsCommas}">
					<script th:inline="javascript">
						addNumberFormatFunction(/*[[${id}]]*/);
					</script>
					</th:block>
				</th:block>
			</th:block>
		</td>
	</div>

	<!--/* inline update button */-->
	<div th:fragment="tdUpdateButton(id, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="10px" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<button type="submit" th:id="'update_' + ${id}" name="showUpdateForm" class="btn btn-sm btn-color-btn text-white"
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-version="${version}"
					onClick="update('listForm', this.id, this.dataset.version);"
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.update')}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
		</td>
	</div>
	
	<!--/* inline delete button */-->
	<div th:fragment="tdDeleteButton(id, recordValueDisplayedOnDelete, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="0px" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<button type="submit" th:id="'delete_' + ${id}" name="delete" class="btn btn-sm btn-color-btn-danger text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-form-name="listForm" th:data-item="${recordValueDisplayedOnDelete}" th:data-version="${version}"
					th:onClick="return del(this.dataset.formName, this.id, this.dataset.item, this.dataset.version);" 
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.delete')}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
		</td>
	</div>

	<!--/* general button */-->
	<div th:fragment="tdButton(itemPropertyPath, id, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="10px" th:rowspan="${@optUtil.getValueOrElse(options, 'rows', '1')}" th:colspan="${@optUtil.getValueOrElse(options, 'cols', '1')}">
			<button type="submit" th:id="${itemPropertyPath} + '_' + ${id}" th:name="${itemPropertyPath}" class="btn btn-sm btn-color-btn text-white"
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-version="${version}"
					th:text="#{__${itemPropertyPath}__}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
			<th:block th:if="${@optUtil.needsOnclickJs(options)}">
				<script th:inline="javascript">
					onTdButtonClick(/*[[${itemPropertyPath}]], [[${id}]]*/);
				</script>
			</th:block>
		</td>
	</div>
	
	<!--/* hidden input for inline button. 上のいずれかのinline buttonを配置する場合は、同一form内にこれを一つ（tableなどのループの外に）置く。中身はただのhiddenだがわかりやすくするため。 */-->
	<div th:fragment="hiddenForInlineButtons(rootRecordName, idFieldName, options)" th:remove="tag">
		<input type="hidden" th:id="${rootRecordName + '.' + idFieldName}" th:name="${rootRecordName + '.' + idFieldName}">
	</div>
	
	<!--/* javaScript for inline update button. inline update buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptFortdUpdateButton(rootRecordName, idFieldName, versionFieldName, options)" th:remove="tag">
		<script th:with="id=${rootRecordName + '.' + idFieldName},versionId=${rootRecordName + '.' + versionFieldName}">
		function update(formName, id, version) {
			document.getElementById("[[${id}]]").value = id.replace('update_', '');
			document.forms[formName].elements["[[${versionId}]]"].value = version;
		}
		</script>
	</div>

	<!--/* javaScript for inline delete button. inline delete buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptFortdDeleteButton(rootRecordName, idFieldName, versionFieldName, itemDisplayedOnDelete, options)" th:remove="tag">
		<script th:with="id=${rootRecordName + '.' + idFieldName},versionId=${rootRecordName + '.' + versionFieldName}">
		function del(formName, id, recordName, version) {
			var message = "[[${@optUtil.getDeleteConfirmMessage(rootRecordName, itemDisplayedOnDelete)}]]" + " " + recordName;
			var bl = confirm(message);
			if (!bl) return false;
			
			document.getElementById("[[${id}]]").value = id.replace('delete_', '');
			document.forms[formName].elements["[[${versionId}]]"].value = version;

			return true;
		}
		</script>
	</div>

	<!--/* 
		### button.
	 */-->

	<!--/* showInsertFormButton */-->
	<div th:fragment="showInsertFormButton(options)" th:remove="tag">
		<button type="submit" name="showInsertForm" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.insert')}"></button>
	</div>

	<!--/* insertOrUpdateButton */-->
	<div th:fragment="insertOrUpdateButton(label, options)" th:remove="tag">
		<button type="submit" th:id="${@optUtil.hasKey(options, 'id') ? 'insertOrUpdate' : null}" name="insertOrUpdate" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${label}"></button>
	</div>
	
</body>
</html>
