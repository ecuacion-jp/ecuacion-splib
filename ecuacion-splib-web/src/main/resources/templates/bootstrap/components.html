<!--

    Copyright © 2012 ecuacion.jp (info@ecuacion.jp)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
</head>
<body>
	
	<!--/* 
		###
		### common components.
		###
	 */-->

	<!--/* 
		### display message components.
	 */-->

	<!--/* internal common display message component. 
		'title' and 'message' can be the key to the message.properties or item_names.properties, 
		or if it does not exist in properties files, it shows the string directly.
	*/-->
	<div th:fragment="displayMessageComponentExternalFrame(contents, options)" th:remove="tag">
		<div class="text-dark" 
				th:with="titleString=${@msgUtil.get(#locale, title)},
				messageString=${@msgUtil.get(#locale, message)}">

			<!--/* content */-->
			<th:block th:replace="${contents}" />
			
		</div>
	</div>

	<!--/* title */-->
	<div th:fragment="title(title, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::titleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="titleInternal" th:remove="tag">
			<div class="fs-3 fw-bold mt-3 mb-5" th:text="${titleString}"></div>
		</div></th:block>
	</div>

	<!--/* titleDesc */-->
	<!--/* It's placed above the message space, so it does not seem very useful. Maybe it will become deprecated in the future. */-->
	<div th:fragment="titleDesc(message, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::titleDescInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="titleDescInternal" th:remove="tag">
			<th:block th:if="${!#strings.isEmpty(messageString)}">
				<div class="mb-5" style="white-space: pre-wrap;" th:text="${messageString}"></div>
			</th:block>
		</div></th:block>
	</div>

	<!--/* subtitle  */-->
	<div th:fragment="subtitle(title, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::subtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="subtitleInternal" th:remove="tag">
			<div class="border-5 border-color-subtitle fs-5 fw-bold mt-5 pt-1 pb-1 ps-3" style="border-left: solid;" th:text="${titleString}"></div>
		</div></th:block>
	</div>

	<!--/* paragraphWithSubtitle */-->
	<div th:fragment="paragraphWithSubtitle(title, message, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::paragraphWithSubtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphWithSubtitleInternal" th:remove="tag">
 			<div th:replace="~{bootstrap/components :: subtitleInternal}"></div>
			<div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* subtitle  */-->
	<div th:fragment="subsubtitle(title, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::subsubtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="subsubtitleInternal" th:remove="tag">
			<div class="mt-5 mb-3 pt-1 pb-1 ps-3">
				<span class="text-color-subtitle me-3 fs-7 fw-bold">-︎</span><span class="fs-5 fw-bold" th:text="${titleString}"></span>
			</div>
		</div></th:block>
	</div>

	<!--/* paragraphWithSubsubtitle */-->
	<div th:fragment="paragraphWithSubsubtitle(title, message, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::paragraphWithSubsubtitleInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphWithSubsubtitleInternal" th:remove="tag">
 			<div th:replace="~{bootstrap/components :: subsubtitleInternal}"></div>
			<div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* paragraph */-->
	<div th:fragment="paragraph(message, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::paragraphInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="paragraphInternal" th:remove="tag">
			<div class="mt-4" style="white-space: pre-wrap;" th:text="${messageString}"></div>
		</div></th:block>
	</div>
	
	<!--/* referenceBox */-->
	<div th:fragment="referenceBox(title, message, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::referenceBoxInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="referenceBoxInternal" th:remove="tag">
			<div class="text-dark mt-4">
				<th:block th:if="${!#strings.isEmpty(titleString)}"><code  class="text-dark" th:text="'[' + ${titleString} + ']'"></code></th:block>
				<div class="border ps-3 pe-3" style="background-color: #ffffe0">
					<pre class="mb-0"><code><div class="mt-3 mb-3" style="white-space: pre-wrap;" th:text="${messageString}"></div></code></pre>
				</div>
			</div>
		</div></th:block>
	</div>

	<!--/* box. space enclosed by a frame. */-->
	<div th:fragment="box(boxContent, title, message, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::boxInternal(${boxContent})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="boxInternal(boxContent)" th:remove="tag">
			<div class="border mt-3">
				<div class="m-3">
					<div class="fs-4 mb-3" th:text="${titleString}"></div>
					<div style="white-space: pre-wrap;" th:text="${messageString}"></div>
					<br>
					
					<th:block th:replace="${boxContent}" />
					 
				</div>
			</div>
		</div></th:block>
	</div>
	
	<!--/* freeSpace. You can input free text / html. It is used for commonize color and font. */-->
	<div th:fragment="freeSpace(content, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: displayMessageComponentExternalFrame(~{::freeSpaceInternal}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="freeSpaceInternal" th:remove="tag">
				<th:block th:replace="${content}" />
		</div></th:block>
	</div>
	
	<!--/* 
		### shape components.
	 */-->
	
	<div th:fragment=horizontalLine(options) th:remove="tag">
		<hr class="mt-4 mb-4">
	</div>
	
	<!--/* 
		### button.
	 */-->
	
	<!--/* backButton */-->
	<div th:fragment="backButton(label, options)" th:remove="tag">
		<button type="submit" id="back" name="back" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${label}"></button>
	</div>
	
	<!--/* general primary button */-->
	<div th:fragment="commonPrimaryButton(id, label, options)" th:remove="tag">
		<button type="submit" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${label}"></button>
	</div>
	
	<!--/* inter-button space */-->
	<span th:fragment="interButtonSpace(options)" th:remove="tag">
		<span>&nbsp;&nbsp;&nbsp;</span>
	</span>

	<!--/* 
		### navbarのmenu components.
	 */-->

	<!--/* 第一階層に、dropdownでない、ただのメニューボタン（＝押したらリンク先へ飛ぶ）を追加する場合に使用。 */-->
	<div th:fragment="navBarMenuItem(href, label, options)" th:remove="tag">
		<li style="margin-left: 20px">
			<a class="nav-link" th:href="${href}" th:text="${label}"></a>
		</li>
	</div>
	
	<div th:fragment="navBarSubMenu(label, menuItems, options)" th:remove="tag">
		<li style="margin-left: 20px" class="nav-item dropdown">
			<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
					data-bs-toggle="dropdown" aria-expanded="false" th:text="${label}"></a>
			<ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown"
					th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
					+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)}">
					<th:block th:replace="${menuItems}" />
			</ul>
		</li>
	</div>

	<div th:fragment="navBarDropDownMenuItem(href, label, options)" th:remove="tag">
		<li><a class="dropdown-item" th:href="${href}" th:text="${label}"></a></li>
	</div>

	<div th:fragment="navBarDropDownMenuDivider(options)" th:remove="tag">
		<li><hr class="dropdown-divider"></li>
	</div>

	<!--/* navBar内に分類をつけたい場合に使用。一番上ないしdividerの直後に使用する想定。 */-->
	<div th:fragment="navBarDropDownMenuGroupLabel(label, options)" th:remove="tag">
		<li class="mb-1"><small>
			<div class="ms-3" style="font-weight: bold" th:text="${'&lt; &nbsp;' + label + '&nbsp; &gt;'}"></div>
		</small></li>
	</div>

	<div th:fragment="navBarDropDownSubMenu(label, menuItems, options)" th:remove="tag">
		<li>
			<a class="dropdown-item" href="#">
				<div style="text-align: left; float: left;" th:text="${label}"></div>
				<div style="text-align: right;" th:text="${options.contains('direction=left') ? '&ltrif;' : '&rtrif;'}">︎</div>
			</a>
			<ul class="dropdown-menu dropdown-submenu dropdown-menu-dark bg-gradient bg-primary"
					th:classappend="${(bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient') 
					+ ' ' + (navbarBgColor == null ? 'bg-color-navbar' : navbarBgColor)
					+ ' ' + (options.contains('direction=left') ? 'dropdown-submenu-left' : '')}">
				<th:block th:replace="${menuItems}" />
			</ul>
		</li>
	</div>



	<!--/* 
		###
		### general formで使用するcomponents.
		### editなどgeneral formを使用しているpageでも使用。
		###
	 */-->
	 
	<!--/* 
		### message表示用components.
	 */-->
	 
	<!--/* messages */-->
	<div th:fragment="messages(options)" th:remove="tag" th:if="${!(noMessages != null && noMessages)}">
		<div class="mt-5 mb-5">
			<!-- messages from url parameter -->
			<div class="all-error-messages-list-wrapper text-danger">
				<div class="bg-color-msg-error-bg p-2 rounded-1" 
						th:if="${param.error != null or param.logoutDone != null or param.accessDenied != null or param.notFound != null}">
					<div th:replace="~{bootstrap/components :: freeSpace(~{::free-space-login-messages}, '')}"></div>
				</div>
			</div>
			<th:block th:if="false"><div th:fragment="free-space-login-messages" th:remove="tag">
				<div th:if="${param.error}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.error')}"></div>
				<div th:if="${param.logoutDone}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.logoutDone')}"></div>
				<div th:if="${param.accessDenied}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.accessDenied')}"></div>
				<div th:if="${param.notFound}" style="white-space: pre-wrap;" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.login.message.notFound')}"></div>
			</div></th:block>
			<!-- messages from ${messagesBean} -->
			<div th:object="${messagesBean}">
				<div class="bg-color-msg-success-bg p-2 rounded-1" th:if="${param.keySet().contains('success') || messagesBean.needsSuccessMessage}">
					<div class="text-success" th:if="${param.success}" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.success')}"></div>
					<div class="text-success" th:if="*{needsSuccessMessage}" th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.success')}"></div>
				</div>
				<div class="all-error-messages-list-wrapper text-danger">
					<div class="bg-color-msg-error-bg p-2 rounded-1" th:if="*{errorMessages != null && errorMessages.size() > 0}">
						<!--/* itemに紐づくエラーメッセージをtopに表示する場合 */-->
						<th:block th:if="${showsMessagesLinkedToItemsAtTheTop}">
							<div class="all-error-messages-list-ul">
								<div th:replace="~{bootstrap/components :: displayMessages(*{errorMessages})}"></div>
							</div>
						</th:block>
						<!--/* itemに紐づくエラーメッセージを個別itemの箇所に表示する場合 */-->
						<th:block th:if="${showsMessagesLinkedToItemsAtEachItem}">
							<ul class="all-error-messages-list-ul">
								<!--/* itemに紐づかないエラーの表示 */-->
								<th:block th:if="*{errorMessagesNotLinkedToItems.size() > 0}">
									<div th:replace="~{bootstrap/components :: displayMessages(*{errorMessagesNotLinkedToItems})}"></div>
								</th:block>
								<!--/* itemに紐づくエラーが存在することを示すメッセージの表示 */-->
								<th:block th:if="*{errorMessagesLinkedToItems.size() > 0}">
									<div th:replace="~{bootstrap/components :: displayMessages(${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.message.messagesLinkedToItemsExist')})}"></div>
								</th:block>
							</ul>
						</th:block>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--/* message表示用内部共通component。本componponentを直接呼ぶのはサポート対象外 */-->
	<div th:fragment="displayMessages(errorMessages)" th:remove="tag">
		<table th:each="message : ${errorMessages}" style="width: 100%;">
			<tr>
				<td style="vertical-align:top; width: 20px"><div style="margin-left: 10px; margin-right: 10px;">- </div></td>
				<td colspan="2"><div class="all-error-messages-list-li" style="white-space: pre-wrap">[[
						${#strings.contains(message, #strings.unescapeJava('\n\n')) ? 
						#strings.substring(message, 0, #strings.indexOf(message, #strings.unescapeJava('\n\n'))) : message}]]</div></td>
			</tr>
			<!--/* 
				subMessage feature.
				See the following for error reasons:\n\nreason1: xxx\nreason2: xxx
				-> 
				- See the following for error reasons:
				  - reason1: xxx
				  - reason2: xxx
			 */-->
			<th:block th:if="${#strings.contains(message, #strings.unescapeJava('\n\n'))}">
				<th:block th:each="subMessage : ${#strings.arraySplit(#strings.substring(message, #strings.indexOf(message, #strings.unescapeJava('\n\n'))), #strings.unescapeJava('\n'))}">
					<tr>
						<td></td>
						<td style="vertical-align:top; width: 10px"><div style="margin-right: 10px">- </div></td>
						<td><div class="all-error-messages-list-li" style="white-space: pre-wrap">[[${subMessage}]]</div></td>
					</tr>
				</th:block>
			</th:block>
		</table>
	</div>

	<div th:fragment="warnMessage(options)" th:remove="tag">
		<div th:object="${messagesBean}">
			<th:block th:if="*{warnMessage != null}">
				<input type="hidden" name="warnMessage" th:data-button-name="*{warnMessage.buttonName}" th:data-msg-id="*{warnMessage.messageId}" th:value="*{warnMessage.message}">
				<script>
					var bl = confirm(this.form.elements['warnMessage'].value);
					var obj = this.form.elements['confirmedWarnings'];
					if (bl) {
						obj.value = obj.value + "," + this.form.elements['warnMessage'].dataset.msgId;
						
						const buttonName = this.form.elements['warnMessage'].dataset.buttonName;
						if (typeof buttonName === "undefined") {
							buttonName = "";
						}
						
						if (buttonName == "") {
							this.form.submit();

						} else {
							var btn = this.form.elements[buttonName];
							btn.click();
						}
						
					} else {
						obj.value = "";
					}
				</script>
			</th:block>
		</div>
	</div>

	<!--/* 
		### hidden components.
	 */-->

	<!--/*
		version.
		initialValueは、画面表示時から値を埋めておきたい場合（単票系の画面）とそうでない場合（一覧系画面）がある。
	 */-->
	<div th:fragment="version(rootRecordName, fieldName, initialValue, options)" th:remove="tag" th:with="id=${rootRecordName + '.' + (fieldName == null || fieldName == '' ? 'version' : fieldName)}">
		<input type="hidden" th:name="${id}" th:value="${initialValue}" />
	</div>

	<!--/* token。単純なものだが複数箇所で使用するので共通化。 */-->
	<div th:fragment="token(options)" th:remove="tag">
		<input type="hidden" name="transactionToken" th:value="${transactionToken}">
	</div>
	
	<!--/* 
		### zone offsetを取得する処理。
	 */-->

	<div th:fragment="sendZoneOffset(options)" th:remove="tag">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<input type="hidden" id="zoneOffsetParams" th:data-url="@{/public/zoneOffset}">
		<script>
		$(function() {
			var offset = new Date().getTimezoneOffset();
			var url = document.getElementById('zoneOffsetParams').dataset.url;
			$.ajax(url + '?zoneOffset=' + offset,
				{
					type: 'get'
				}
			)
		});
		</script>
	</div>

	<!--/* 
		### form
	 */-->

	<!--/* generalForm */-->
	<div th:fragment="generalForm(formContent, topSpaceContent, bottomSpaceContent
			, formMethod, multipart, subFunction, versionFieldName, versionInitialValue, options)" th:remove="tag">
		<th:block th:with="subFunction=${subFunction == null ? '' : subFunction}">
			<th:block th:with="htmlFormName=${subFunction + (subFunction == '' ? 'form' : 'Form')},
					javaFormName=${function + #strings.capitalize(subFunction) + 'Form'}">

				<th:block th:replace="${topSpaceContent}" />

				<div class="mt-5"></div>

				<!--/* issue#156: Since the error message is hard to understand when ${__${javaFormName}__} == null, understandable message output procedure is added. */-->
				<th:block th:if="${__${javaFormName}__} == null"
						th:with="msg=${'Form not found in model. Form name: ' + javaFormName + '. 
								The reason can be: Form with the name not defined; 
								Form is defined but not used (not set in the generics parameter of the controller definition sentence);'}">
					[[${@exUtil.systemError(msg)}]]
				</th:block>

				<!--/* subFunction, ctrlSubFunctionの挙動については#454参照。  */-->
				<form th:name="${htmlFormName}" th:id="${htmlFormName}" 
						th:method="${formMethod == null || formMethod == '' ? 'post' : formMethod}"
						th:enctype="${multipart == null || multipart == false ? 'application/x-www-form-urlencoded' : 'multipart/form-data'}"
						th:action="@{/} + ${#strings.replace(loginState, '-', '/')} + '/' + ${functionKindsPathString} + ${function} + ${(ctrlSubFunction == null ? (subFunction == null || subFunction == '' ? '' : '/' + subFunction) : (ctrlSubFunction == '' ? '' : '/' + ctrlSubFunction)) + '/action'}"
						th:object="${__${javaFormName}__}">
					<div th:replace="~{bootstrap/components :: token('')}"></div>
					<!--/* controller側からmodelに渡すformm名が間違えている場合にいつもここでエラーになるが、設定したform名が取得できずdebugしているので、
					       赤字でエラー表示しつつform名を出力 */-->
					<h1 style="color: red" th:if="${__${function + #strings.capitalize(subFunction) + 'Form'}__} == null">
						form: [[${function + #strings.capitalize(subFunction) + 'Form'}]] is null.
					</h1> 
					
					<!--/* confirmedWarningsで、formの外からボタンクリックが必要なためform名を保持しておく */-->
					<input type="hidden" name="htmlFormName" th:value="${htmlFormName}">
					<input type="hidden" name="confirmedWarnings" th:data-html-form-name="${htmlFormName}" th:value="*{confirmedWarnings}">
		 			<input type="hidden" name="submitOnChangeToRefresh">
					<div th:replace="~{bootstrap/components :: version(${rootRecordName}, ${versionFieldName}, ${versionInitialValue}, '')}"></div>
					<th:block th:replace="${formContent}" />
		
					<div th:replace="~{bootstrap/components :: warnMessage('')}"></div>
	
	 			</form>
				
				<th:block th:replace="${bottomSpaceContent}" />
		
			</th:block>
		</th:block>
	</div>



	<!--/* 
		###
		### search components.
		###
	 */-->

	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="searchComponentLabel(propertyPathWithoutRootRecord, postfix, options)" th:remove="tag">
		<th:block th:with="recordName=${propertyPathWithoutRootRecord.contains('.') ? rootRecordName + '.' + propertyPathWithoutRootRecord.substring(0, propertyPathWithoutRootRecord.lastIndexOf('.')) : rootRecordName},
				fieldName=${propertyPathWithoutRootRecord.contains('.') ? propertyPathWithoutRootRecord.substring(propertyPathWithoutRootRecord.lastIndexOf('.') + 1) : propertyPathWithoutRootRecord}">
			<th:block th:with="labelRecordName=${#strings.contains(recordName, '.') ? #strings.substring(recordName, #strings.indexOf(recordName, '.') + 1) : recordName}">
				<label th:for="${id}" class="form-label text-dark" 
						th:with="labelFieldName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${propertyPathWithoutRootRecord}__')}">
					[[#{__${labelFieldName}__}]] [[${postfix}]]
				</label>
			</th:block>
		</th:block>
	</div>
	
	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="searchComponentExternalFrame(propertyPath, contents, labelPostfix, options)" th:remove="tag">
		<th:block th:with="recordName=${propertyPathWithoutRootRecord.contains('.') ? rootRecordName + '.' + propertyPathWithoutRootRecord.substring(0, propertyPathWithoutRootRecord.lastIndexOf('.')) : rootRecordName},
				fieldName=${propertyPathWithoutRootRecord.contains('.') ? propertyPathWithoutRootRecord.substring(propertyPathWithoutRootRecord.lastIndexOf('.') + 1) : propertyPathWithoutRootRecord}">
			<th:block th:with="id=${recordName + '.' + fieldName},value=*{__${recordName + '.' + fieldName}__}">
				<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
					<div th:replace="~{bootstrap/components :: searchComponentLabel(${propertyPathWithoutRootRecord}, ${labelPostfix}, ${options})}"></div>
					<th:block th:replace="${contents}" />
				</div>
			</th:block>
		</th:block>
	</div>
	
	<div th:fragment="searchText(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: searchComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::searchTextInternal(${propertyPathWithoutRootRecord}, 
				${options})}, *{__${rootRecordName}__.getSearchPatternComment(#locale, '__${propertyPathWithoutRootRecord}__')}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchTextInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<input type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" th:value="${value}"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}"
				th:maxlength="${@optUtil.isReadOnly(options)} ? '' : *{__${recordName}__.getStringLength('__${fieldName}__')}"
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<div th:fragment="searchNumber(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: searchComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::searchNumberInternal(${propertyPathWithoutRootRecord}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchNumberInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<input type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" th:value="${value}"
				class="text-end"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}"
				th:maxlength="${@optUtil.isReadOnly(options)} ? '' : *{__${recordName}__.getStringLength('__${fieldName}__')}"
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>
	 
	<div th:fragment="searchDate(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: searchComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::searchDateInternal(${propertyPathWithoutRootRecord}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchDateInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<input type="date" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" th:name="${id}" th:value="${value}"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}" 
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<div th:fragment="searchSelect(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: searchComponentSelect(${propertyPathWithoutRootRecord}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(propertyPathWithoutRootRecord)}__()}, ${options})}"></div>
	</div>
	
	<!--/* 
		- options:
		  - including: 指定したEnum要素のみをプルダウンに表示。'include=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - excluding: 指定したEnum要素以外をプルダウンに表示。'exclude=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - firstCharOfCodeEqualTo: codeの一文字目が等しい場合にtrue
		  - firstCharOfCodeLessThanOrEqualTo: codeの一文字目をascii codeの大小で比較
		  - firstCharOfCodeGreaterThanOrEqualTo: codeの一文字目をascii codeの大小で比較
	 */-->
	<div th:fragment="searchSelectFromEnum(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: searchComponentSelect(${propertyPathWithoutRootRecord}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(propertyPathWithoutRootRecord)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>
	
	<!--/* 内部共通component。本componponentを直接呼ぶのはサポート対象外 */-->
	<div th:fragment="searchComponentSelect(propertyPathWithoutRootRecord, pairs, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: searchComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::searchSelectInternal(${propertyPathWithoutRootRecord}, ${options})}, '',  ${options})}"></div>

		<th:block th:if="false"><div th:fragment="searchSelectInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<select class="form-select" th:id="${@optUtil.hasKey(options, 'id') ? id : null}" 
					th:name="${id}"
					th:classappend="${messagesBean.isValid(id)}" 
					th:data-submit-on-change-to-refresh="${@optUtil.hasKey(options, 'submitOnChangeToRefresh')}"
					th:data-html-form-name="${htmlFormName}"
					onchange="if (this.dataset.submitOnChangeToRefresh == 'true') {document.forms[this.dataset.htmlFormName].elements['submitOnChangeToRefresh'].value = 'true'; this.form.submit();}">
				<option th:if="${@optUtil.needsEmptyOption(options)}" th:selected="${value == null || value == ''}"></option>
				<th:block th:each="pair : ${pairs}">
					<!--/* 通常の文字列だとpre-processingは不要だったのだが、booleanを処理しようとすると子hの形でないと認識されなかった */-->
					<option th:value="${pair[0]}" th:selected="${pair[0] == '__${value}__'}">[[${pair[1]}]]</option>
				</th:block>
			</select>
		</div></th:block>
	</div>
	
	<!--/* 
		### tableのsort, pagination, 表示行数の関連components。
	 */-->
	
	<!--/* sort, paging, 表示件数をまとめた機能  */-->
	<div th:fragment="sortPagingAndRecordsInScreen(form, options)" th:remove="tag">
		<input type="hidden" id="sortItem" name="sortItem" th:value="${form.sortItem}">
		<input type="hidden" id="direction" name="direction" th:value="${form.direction}">
		<input type="hidden" id="page" name="page" th:value="${form.page}">
		<input type="hidden" id="recordsInScreen" name="recordsInScreen" th:value="${form.recordsInScreen}">
		<input type="hidden" id="requestFromSearchForm" name="requestFromSearchForm" value="true">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-4 align-self-end">
					<div>[[${form.linesInScreen}]]</div>
				</div>
				<div class="col-md-4">
					<nav aria-label="Page navigation" th:if="${form.getPagerInfoList(#locale).size() > 0}">
						<ul class="pagination justify-content-center">
							<th:block th:each="pagerInfo : ${form.getPagerInfoList(#locale)}" th:object="${pagerInfo}" th:remove="tag">
								<li class="page-item" th:classappend="*{status}">
									<a th:if="*{isDisabled()}" class="page-link text-light" href="#" tabindex="-1" aria-disabled="true" th:text="*{displayString}"></a>
									<a th:if="*{!isDisabled()}" class="page-link" th:data-page="*{goToPage}" 
											href="#" onClick="listFromPage(this.dataset.page);" th:text="*{displayString}"></a>
								</li>
							</th:block>
						</ul>
					</nav>
				</div>
				<div class="col-md-4" style="text-align:right; padding-right: 0px">
					<div class="dropdown">
						<button class="text-white btn btn-color-paging-btn dropdown-toggle mb-3" 
								th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
								type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
							[[${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.label.recordsInScreen')}]]
						</button>
						<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(5)">5</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(10)">10</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(20)">20</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(50)">50</a></li>
							<li><a class="dropdown-item" href="javascript:listFromRecordsInScreen(100)">100</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--/* 
		### button.
	 */-->

	<!--/* searchButton */-->
	<div th:fragment="searchButton(options)" th:remove="tag">
		<button type="submit" name="search" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.search')}"></button>
	</div>

	<!--/* searchConditionClearButton */-->
	<div th:fragment="searchConditionClearButton(options)" th:remove="tag">
		<button type="submit" name="conditionClear" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.conditionClear')}"></button>
	</div>

	<!--/* 
		### 検索関連のscript。
	 */-->
	 
	<!--/* javaScript for inline update button. inline update buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptForThSortable(options)" th:remove="tag">
		<script>
		function list(sortItem, direction) {
			document.getElementById("sortItem").value = sortItem;
			document.getElementById("direction").value = direction;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>	
	</div>
	
	<div th:fragment="scriptForRecordsInScreen(options)" th:remove="tag">
		<script>
		function listFromRecordsInScreen(recordsInScreen) {
			document.getElementById("recordsInScreen").value = recordsInScreen;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>
	</div>

	<div th:fragment="scriptForPagenation(options)" th:remove="tag">
		<script>
		function listFromPage(page) {
			document.getElementById("page").value = page;
			document.getElementById("action").value = "searchAgain";
			document.searchForm.submit();
		}
		</script>
	</div>
	
	<!-- /* 3つのscriptをまとめたもの。htmlパーツ側も結局セットにしたのでscript側もセットで使用することとする */ -->
	<div th:fragment="scriptForSortPagingAndRecordsInScreen(options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: scriptForThSortable('')}"></div>
		<div th:replace="~{bootstrap/components :: scriptForRecordsInScreen('')}"></div>
		<div th:replace="~{bootstrap/components :: scriptForPagenation('')}"></div>
	</div>



	<!--/* 
		###
		### list関連components.
		###
	 */-->

	<!--/* 
		### table header(th).
	 */-->

	<!--/* sort不可能なth。text-alignはcenter固定。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thText(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: thCustomizable(${propertyPathWithoutRootRecord}, 'center', ${options})}"></div>
	</div>
	
	<!--/* sort可能なth。text-alignはcenter固定。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thSortable(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: thCustomizable(${propertyPathWithoutRootRecord}, 'center', ${options + ',thSortable'})}"></div>
	</div>
	
	<!--/* カスタマイズ可能なsort可能なth。formは引数に与えていないが外でth:withでformという名前に設定しておく必要あり */-->
	<div th:fragment="thCustomizable(propertyPathWithoutRootRecord, position, options)" th:remove="tag">
		<th:block th:with="recordName=${propertyPathWithoutRootRecord.contains('.') ? rootRecordName + '.' + propertyPathWithoutRootRecord.substring(0, propertyPathWithoutRootRecord.lastIndexOf('.')) : rootRecordName},
				fieldName=${propertyPathWithoutRootRecord.contains('.') ? propertyPathWithoutRootRecord.substring(propertyPathWithoutRootRecord.lastIndexOf('.') + 1) : propertyPathWithoutRootRecord}">
			<th:block th:with="id=${recordName + '.' + fieldName},labelFieldName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${propertyPathWithoutRootRecord}__')}">
				<th:block th:if="${@optUtil.hasThSortable(options)}">
					<th scope="col" th:class="'text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
							style="cursor: pointer" th:text="#{__${labelFieldName}__}" 
							th:data-item="${propertyPathWithoutRootRecord}" th:data-direction="${form.nextDirection('__${propertyPathWithoutRootRecord}__')}"
							onClick="list(this.dataset.item, this.dataset.direction);"></th>
		 		</th:block>
		 		<th:block th:if="${!@optUtil.hasThSortable(options)}">
					<th scope="col" th:class="'text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
							th:text="#{__${labelFieldName}__}"></th>
		 		</th:block>
	 	</th:block>
	</div>
	
	<!--/* ただのth。引数で表示するlabelを指定。 */-->
	<div th:fragment="thFreeText(label, options)" th:remove="tag">
		<th scope="col" class="text-center" th:text="${label}"></th>
	</div>
	
	<!--/* 
		### 以下、table内のinline componentsとjavascriptなど。
		### td系（ただしボタンを除く）は、その外でth:with="deleted=true"と与えると、文字が薄くなり削除されたっぽい効果がつく。
	 */-->
	
	<!--/* td readOnly text */-->
	<div th:fragment="tdReadOnlyText(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(propertyPathWithoutRootRecord)}">
			<div th:replace="~{bootstrap/components :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly number */-->
	<div th:fragment="tdReadOnlyNumber(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(propertyPathWithoutRootRecord)},
				needsCommas=*{needsCommas('__${rootRecordName}__', '__${propertyPathWithoutRootRecord}__')}">
			<div th:replace="~{bootstrap/components :: tdReadOnlyCustomizable(${((needsCommas && @strUtil.isNumberFormat(value)) ? #numbers.formatDecimal(value, 1, 'COMMA', 0, 'POINT')
					: value)}, 'right', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly fixed length */-->
	<div th:fragment="tdReadOnlyFixedLength(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<th:block th:with="value=${rec.getValue(propertyPathWithoutRootRecord)}">
			<div th:replace="~{bootstrap/components :: tdReadOnlyCustomizable(${value}, 'center', ${options})}"></div>
		</th:block>
	</div>
	
	<!--/* td readOnly free text */-->
	<div th:fragment="tdReadOnlyFreeText(value, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
	</div>
	
	<!--/* td readOnly free fixed length */-->
	<div th:fragment="tdReadOnlyFreeFixedLength(value, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: tdReadOnlyCustomizable(${value}, 'center', ${options})}"></div>
	</div>
	
	<!--/* td readOnly enum text */-->
	<div th:fragment="tdReadOnlyEnumText(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<th:block th:with="value=${rec.get__${#strings.capitalize(propertyPathWithoutRootRecord)}__Name(#locale)}">
			<div th:replace="~{bootstrap/components :: tdReadOnlyCustomizable(${value}, 'left', ${options})}"></div>
		</th:block>
	</div>

	<!--/* td readOnly customizable */-->
	<div th:fragment="tdReadOnlyCustomizable(value, position, options)" th:remove="tag">
		<td th:class="'align-middle fs-6 text-' + ${position == 'left' ? 'start' : (position == 'right' ? 'end' : position)}"
				th:th:rowspan="${@optUtil.rows(options)}" th:colspan="${@optUtil.cols(options)}"
				th:classappend="${(deleted != null && deleted) || @optUtil.isDeleted(options)} ? 'text-deleted' : 'text-dark'">
			<th:block th:if="${@optUtil.hasLinkUrl(options)}">
				<a th:href="${@optUtil.getLinkUrl(options)}" target="_blank">[[${value}]]</a>
			</th:block>
			<th:block th:if="${@optUtil.hasLinkUrl(options) == false}">
				[[${value}]]
			</th:block>
		</td>
	</div>
	
	<!--/* td readOnly checkbox */-->
	<div th:fragment="tdReadOnlyCheckbox(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<td class="align-middle text-center" th:th:rowspan="${@optUtil.rows(options)}" th:colspan="${@optUtil.cols(options)}">
			<input class="form-check-input align-bottom mb-1 " type="checkbox" th:checked="*{__${propertyPathWithoutRootRecord}__}" disabled>
		</td>
	</div>
	
	<!--/* inline input number */-->
	<div th:fragment="tdInputNumber(propertyPathWithoutRootRecord, idValue, options)" th:remove="tag">
		<td class="align-middle text-center" th:rowspan="${@optUtil.rows(options)}" th:colspan="${@optUtil.cols(options)}">
			<th:block th:with="recordName=${propertyPathWithoutRootRecord.contains('.') ? rootRecordName + '.' + propertyPathWithoutRootRecord.substring(0, propertyPathWithoutRootRecord.lastIndexOf('.')) : rootRecordName},
					fieldName=${propertyPathWithoutRootRecord.contains('.') ? propertyPathWithoutRootRecord.substring(propertyPathWithoutRootRecord.lastIndexOf('.') + 1) : propertyPathWithoutRootRecord}">
				<th:block th:with="id=${recordName + '.' + fieldName + '_' + idValue},value=${rec.getValue(propertyPathWithoutRootRecord)},
						needsCommas=*{needsCommas('__${rootRecordName}__', '__${propertyPathWithoutRootRecord}__')}">
					<input th:type="text" th:id="${@optUtil.hasKey(options, 'id') ? id : null}"
							th:value="${(needsCommas && @strUtil.isNumberFormat(value)) ? #numbers.formatDecimal(#strings.replace(value, ',', ''), 1, 'COMMA', 0, 'POINT') : value}"
							class="text-end form-control-sm fs-6 text-dark"
							th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(id)}" 
							th:readonly="${@optUtil.isReadOnly(options)}">
					<th:block th:if="${needsCommas}">
					<script th:inline="javascript">
						addNumberFormatFunction(/*[[${id}]]*/);
					</script>
					</th:block>
				</th:block>
			</th:block>
		</td>
	</div>

	<!--/* inline update button */-->
	<div th:fragment="tdUpdateButton(id, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="10px" th:rowspan="${@optUtil.rows(options)}" th:colspan="${@optUtil.cols(options)}">
			<button type="submit" th:id="'update_' + ${id}" name="showUpdateForm" class="btn btn-sm btn-color-btn text-white"
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-version="${version}"
					onClick="update('listForm', this.id, this.dataset.version);"
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.update')}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
		</td>
	</div>
	
	<!--/* inline delete button */-->
	<div th:fragment="tdDeleteButton(id, recordValueDisplayedOnDelete, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="0px" th:rowspan="${@optUtil.rows(options)}" th:colspan="${@optUtil.cols(options)}">
			<button type="submit" th:id="'delete_' + ${id}" name="delete" class="btn btn-sm btn-color-btn-danger text-white" 
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-form-name="listForm" th:data-item="${recordValueDisplayedOnDelete}" th:data-version="${version}"
					th:onClick="return del(this.dataset.formName, this.id, this.dataset.item, this.dataset.version);" 
					th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.delete')}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
		</td>
	</div>

	<!--/* general button */-->
	<div th:fragment="tdButton(propertyPathWithoutRootRecord, id, version, options)" th:remove="tag">
		<td class="text-center p-1 align-middle" height="10px" th:rowspan="${@optUtil.rows(options)}" th:colspan="${@optUtil.cols(options)}">
			<button type="submit" th:id="${propertyPathWithoutRootRecord} + '_' + ${id}" th:name="${propertyPathWithoutRootRecord}" class="btn btn-sm btn-color-btn text-white"
					th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
					th:data-version="${version}"
					th:text="#{__${propertyPathWithoutRootRecord}__}"
					th:disabled=${@optUtil.isDisabled(options)}>
			</button>
			<th:block th:if="${@optUtil.needsOnclickJs(options)}">
				<script th:inline="javascript">
					onTdButtonClick(/*[[${propertyPathWithoutRootRecord}]], [[${id}]]*/);
				</script>
			</th:block>
		</td>
	</div>
	
	<!--/* hidden input for inline button. 上のいずれかのinline buttonを配置する場合は、同一form内にこれを一つ（tableなどのループの外に）置く。中身はただのhiddenだがわかりやすくするため。 */-->
	<div th:fragment="hiddenForInlineButtons(rootRecordName, idFieldName, options)" th:remove="tag">
		<input type="hidden" th:id="${rootRecordName + '.' + idFieldName}" th:name="${rootRecordName + '.' + idFieldName}">
	</div>
	
	<!--/* javaScript for inline update button. inline update buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptFortdUpdateButton(rootRecordName, idFieldName, versionFieldName, options)" th:remove="tag">
		<script th:with="id=${rootRecordName + '.' + idFieldName},versionId=${rootRecordName + '.' + versionFieldName}">
		function update(formName, id, version) {
			document.getElementById("[[${id}]]").value = id.replace('update_', '');
			document.forms[formName].elements["[[${versionId}]]"].value = version;
		}
		</script>
	</div>

	<!--/* javaScript for inline delete button. inline delete buttonを配置するならこれも併せて配置。通常ページの一番下に配置。  */-->
	<div th:fragment="scriptFortdDeleteButton(rootRecordName, idFieldName, versionFieldName, itemDisplayedOnDelete, options)" th:remove="tag">
		<script th:with="id=${rootRecordName + '.' + idFieldName},versionId=${rootRecordName + '.' + versionFieldName}">
		function del(formName, id, recordName, version) {
			var message = "[[${@optUtil.getDeleteConfirmMessage(rootRecordName, itemDisplayedOnDelete)}]]" + " " + recordName;
			var bl = confirm(message);
			if (!bl) return false;
			
			document.getElementById("[[${id}]]").value = id.replace('delete_', '');
			document.forms[formName].elements["[[${versionId}]]"].value = version;

			return true;
		}
		</script>
	</div>

	<!--/* 
		### button.
	 */-->

	<!--/* showInsertFormButton */-->
	<div th:fragment="showInsertFormButton(options)" th:remove="tag">
		<button type="submit" name="showInsertForm" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${@msgUtil.get(#locale, 'jp.ecuacion.splib.web.common.button.insert')}"></button>
	</div>
	
	<!--/* insertOrUpdateButton */-->
	<div th:fragment="insertOrUpdateButton(label, options)" th:remove="tag">
		<button type="submit" th:id="${@optUtil.hasKey(options, 'id') ? 'insertOrUpdate' : null}" name="insertOrUpdate" class="btn btn-color-btn text-white" 
				th:classappend="${bsBgGradient == null || !bsBgGradient ? '' : 'bg-gradient'}"
				th:text="${label}"></button>
	</div>

	<!--/* 
		###
		### input components
		###
	 */-->
	
	<!--/* internal common input component. */-->
	<!--/* options: 
			- id		arbitrary	specifies 'id' attribute of the html component. As default "htmlFormName + '.' + propertyPath"
			- width		arbitrary	specifies width of the html component. values can be 'full' or 'half'.
	*/-->
	<div th:fragment="inputComponentExternalFrame(propertyPathWithoutRootRecord, contents, options)" th:remove="tag">
		<th:block th:with="propertyPathClass=${propertyPathWithoutRootRecord.contains('.') 
				? rootRecordName + '.' + propertyPathWithoutRootRecord.substring(0, propertyPathWithoutRootRecord.lastIndexOf('.')) : rootRecordName},
				propertyPathField=${propertyPathWithoutRootRecord.contains('.') 
				? propertyPathWithoutRootRecord.substring(propertyPathWithoutRootRecord.lastIndexOf('.') + 1) : propertyPathWithoutRootRecord},
				itemKindIdClass=${propertyPathWithoutRootRecord.contains('.') ? propertyPathWithoutRootRecord.substring(propertyPathWithoutRootRecord.lastIndexOf('.') + 1) : rootRecordName}">
			<th:block th:with="propertyPath=${propertyPathClass + '.' + propertyPathField}, itemKindId=${itemKindIdClass + '.' + propertyPathField}">
				<th:block th:with="inputValue=*{__${propertyPath}__}, inputName=${propertyPath},
						inputId=${@optUtil.hasKey(options, 'id') ? @optUtil.getValue(options, 'id') : (htmlFormName + '.' + propertyPath)}">
					<div class="mb-4" th:classappend="${@optUtil.hasKey(options, 'width') and @optUtil.getValue(options, 'width') == 'full'} 
							? 'col-12' : (${@optUtil.hasKey(options, 'width') and @optUtil.getValue(options, 'width') == 'half'}
							? ' col-md-6' : 'col-xl-3 col-lg-4 col-md-6')">

						<!--/* label */-->
						<th:block th:with="displayName=*{__${rootRecordName}__.getDisplayName('__${rootRecordName}__', '__${propertyPathWithoutRootRecord}__')}">
								<!--/* isPrincipalStringは、#authentication.principalが、loginしている場合は複数項目を格納するbeanなのに、loginしていない場合はStringといういやらしい仕様なので、String可動化をチェックしている */-->
							<label th:for="${inputId}" class="form-label text-dark" th:with="isPrincipalString=${#authentication.principal.class.name == 'java.lang.String'}">
								[[${@msgUtil.get(#locale, '__${displayName}__')}]]<span class="text-danger" th:if="*{__${rootRecordName}__.isNotEmpty('__${propertyPathWithoutRootRecord}__', '__${loginState}__', '__${isPrincipalString ? '' : #authentication.principal.authorities}__')}">&nbsp;*</span>
							</label>
						</th:block>
						
						<!--/* content */-->
						<th:block th:replace="${contents}" />
	
						<!--/* field messages */-->
						<th:block th:if="${showsMessagesLinkedToItemsAtEachItem}">
							<div class="text-danger" th:if="${messagesBean.getErrorMessages('__${propertyPath}__') != null}"
								th:classappend="${@optUtil.isForSwitch(options) ? 'mt-1' : ''}"
								th:each="message : ${messagesBean.getErrorMessages('__${propertyPath}__')}">[[${message}]]</div>
						</th:block>
						
					</div>
				</th:block>
			</th:block>
		</th:block>	
	</div>
	
	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="inputComponentText(propertyPathWithoutRootRecord, type, needsMaxLength, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputTextInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputTextInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<input th:type="${type}" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}"
					th:maxlength="${@optUtil.isReadOnly(options) || type == 'hidden'} ? '' : *{__${propertyPathClass}__.getStringLength('__${propertyPathField}__')}"
					th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
					th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<div th:fragment="inputText(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentText(${propertyPathWithoutRootRecord}, 'text', true, ${options})}"></div>
	</div>
	
	<!--/* textbox(password) */-->
	<div th:fragment="inputPassword(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentText(${propertyPathWithoutRootRecord}, 'password', true, ${options})}"></div>
	</div>
	
	<!--/* inputNumber */-->
	<div th:fragment="inputNumber(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputNumberInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputNumberInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<th:block th:with="needsCommas=*{__${rootRecordName}__.needsCommas('__${rootRecordName}__', '__${propertyPathWithoutRootRecord}__')}">
				<input th:type="text" th:id="${inputId}" th:name="${inputName}"
						th:value="${(needsCommas && @strUtil.isNumberFormat(inputValue)) ? #numbers.formatDecimal(#strings.replace(inputValue, ',', ''), 1, 'COMMA', 0, 'POINT') : inputValue}"
						th:maxlength="${@optUtil.isReadOnly(options)} ? '' : *{__${propertyPathClass}__.getStringLength('__${propertyPathField}__')}"
						class="text-end"
						th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
						th:readonly="${@optUtil.isReadOnly(options)}">
				<th:block th:if="${needsCommas}">
					<script th:inline="javascript">
						addNumberFormatFunction(/*[[${rootRecordName + '.' + propertyPathWithoutRootRecord}]]*/);
					</script>
				</th:block>
			</th:block>
		</div></th:block>
	</div>

	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="inputComponentDateTime(propertyPathWithoutRootRecord, type, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputDateTimeInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputDateTimeInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<input th:type="${type}" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}"
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
				th:readonly="${@optUtil.isReadOnly(options)}">
		</div></th:block>
	</div>

	<!--/* textbox(month) */-->
	<div th:fragment="inputYearMonth(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentDateTime(${propertyPathWithoutRootRecord}, 'month', ${options})}"></div>
	</div>

	<!--/* textbox(date) */-->
	<div th:fragment="inputDate(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentDateTime(${propertyPathWithoutRootRecord}, 'date', ${options})}"></div>
	</div>

	<!--/* textbox(time) */-->
	<div th:fragment="inputTime(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentDateTime(${propertyPathWithoutRootRecord}, 'time', ${options})}"></div>
	</div>

	<!--/* textarea */-->
 	<div th:fragment="inputTextArea(propertyPathWithoutRootRecord, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputTextAreaInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputTextAreaInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<textarea th:id="${inputId}" th:name="${inputName}" th:text="${inputValue}"
				th:maxlength="*{__${propertyPathClass}__.getStringLength('__${propertyPathField}__')}" 
				th:classappend="${(@optUtil.isReadOnly(options)) ? 'form-control-plaintext' : 'form-control ' + messagesBean.isValid(propertyPath)}" 
				th:readonly="${@optUtil.isReadOnly(options)}" rows="3">
			</textarea>
		</div></th:block>
	</div>

	<!--/* checkbox (switch) */-->
	<div th:fragment="inputSwitch(propertyPathWithoutRootRecord, options)" th:remove="tag">
 		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputSwitchInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputSwitchInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<div class="form-check form-switch mt-2">
				<th:block th:if="${@optUtil.isReadOnly(options)}">
					<input type="hidden" th:id="${inputId}" th:name="${inputName}" th:value="${inputValue}">
				</th:block>
				<div>
					<input type="hidden" th:name="${@optUtil.isReadOnly(options) ? '' : inputName}" value="off">
					<input th:id="${inputId}" th:name="${@optUtil.isReadOnly(options) ? '' : propertyPath}"
						class="form-check-input align-bottom mb-1" type="checkbox" 
						th:checked="${inputValue}"
						th:classappend="${messagesBean.isValid(propertyPath)}"
						th:disabled="${@optUtil.isReadOnly(options)}">
				</div>
			</div>
		</div></th:block>
	</div>
	 
	<!--/* checkbox */-->
	<div th:fragment="inputCheckboxes(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputCheckboxesInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputCheckboxesInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<div class="form-check mt-2" th:each="option : *{__${propertyPathClass + '.' + propertyPathField + 'List'}__}">
				<th:block th:with="optionId=${option[0]},optionLabel=${option[1]},optionOptions=${option.length == 2 ? '' : option[2]}">
					<input th:id="${optionId}" class="form-check-input align-bottom mb-1" type="checkbox" 
						th:name="${@optUtil.isReadOnly(optionOptions) ? '' : propertyPath}" 
						th:checked="*{__${propertyPathClass + '.' + propertyPathField + '.contains(''' + optionId + ''')'}__}"
						th:classappend="${messagesBean.isValid(propertyPath)}"
						th:disabled="${@optUtil.isReadOnly(optionOptions)}"
						th:value="${optionId}">
					<label class="form-check-label text-dark" th:for="${optionId}" th:text="${optionLabel}"></label>
					<th:block th:if="${@optUtil.isReadOnly(optionOptions)}">
						<input type="hidden" th:name="${propertyPath}" th:value="${optionId}">
					</th:block>
				</th:block>
			</div>
		</div></th:block>
	</div>
	
	<div th:fragment="inputSelect(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentSelect(${propertyPathWithoutRootRecord}, *{__${rootRecordName}__.__${@strUtil.selectListMethodName(propertyPathWithoutRootRecord)}__()}, ${options})}"></div>
	</div>

	<!--/* 
		- options:
		  - including: 指定したEnum要素のみをプルダウンに表示。'include=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - excluding: 指定したEnum要素以外をプルダウンに表示。'exclude=ADMIN,GROUP_ADMIN' など、enumの要素名で、カンマ区切り指定。（codeではない）
		  - firstCharOfCodeEqualTo: codeの一文字目が等しい場合にtrue
		  - firstCharOfCodeLessThanOrEqualTo: codeの一文字目をascii codeの大小で比較
		  - firstCharOfCodeGreaterThanOrEqualTo: codeの一文字目をascii codeの大小で比較
	 */-->
	<div th:fragment="inputSelectFromEnum(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentSelect(${propertyPathWithoutRootRecord}, 
				*{__${rootRecordName}__.__${@strUtil.selectListMethodName(propertyPathWithoutRootRecord)}__(#locale, '__${options}__')}, ${options})}"></div>
	</div>

	<!--/* internal common component. It's not supposed to use directly from thymeleaf web pages. */-->
	<div th:fragment="inputComponentSelect(propertyPathWithoutRootRecord, pairs, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputComponentSelectInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputComponentSelectInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<!--/* selectにはreadonlyが存在しないため、disabledを使用 */-->
			<th:block th:if="${@optUtil.isReadOnly(options)}">
				<input type="hidden" th:id="${@optUtil.hasKey(options, 'id') ? propertyPath : null}" th:name="${propertyPath}" th:value="${inputValue}">
			</th:block>
			<select th:id="${inputId}" th:name="${@optUtil.isReadOnly(options) ? '' : propertyPath}"
					class="form-select" th:classappend="${messagesBean.isValid(propertyPath)}"
					th:disabled="${@optUtil.isReadOnly(options)}"
					th:data-submit-on-change-to-refresh="${@optUtil.hasKey(options, 'submitOnChangeToRefresh')}"
					th:data-html-form-name="${htmlFormName}"
					onchange="if (this.dataset.submitOnChangeToRefresh == 'true') {document.forms[this.dataset.htmlFormName].elements['submitOnChangeToRefresh'].value = 'true'; this.form.submit();}">
				<option th:if="${@optUtil.needsEmptyOption(options)}" th:selected="${inputValue == null || inputValue == ''}"></option>
				<th:block th:each="pair : ${pairs}">
					<option th:value="${pair[0]}" th:selected="${pair[0] == inputValue}">[[${pair[1]}]]</option>
				</th:block>
			</select>
		</div></th:block>
	</div>
	
	<!--/* component for file upload */-->
	<div  th:fragment="inputFile(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentExternalFrame(${propertyPathWithoutRootRecord}, ~{::inputFileInternal(${propertyPathWithoutRootRecord}, ${options})}, ${options})}"></div>

		<th:block th:if="false"><div th:fragment="inputFileInternal(propertyPathWithoutRootRecord, options)" th:remove="tag">
			<input class="form-control" type="file" th:id="${inputId}" th:name="${propertyPath}" 
					th:classappend="${messagesBean.isValid(propertyPath)}">
		</div></th:block>
	</div>

	<!--/* hidden */-->
	<div th:fragment="inputHidden(propertyPathWithoutRootRecord, options)" th:remove="tag">
		<div th:replace="~{bootstrap/components :: inputComponentText(${propertyPathWithoutRootRecord}, 'hidden', false, ${options})}"></div>
	</div>
	
	<!--/* 
		###
		### baloon関連components
		###
	 */-->

	<!--/* balloon。
		- special thanks to: https://stand-4u.com/css/fukidashi.html
		- 問い合わせ等でのやり取りの履歴をチャット形式で残す際に使用。
		- 使用する個数は動的なため、ループの中に記載することになるが、右（本人）と左（他人）の出てくる順番もランダムのため、componentとしてはひとつのballoonとし、引数で左右を分ける形とした。
	 */-->
	<div  th:fragment="speechBalloon(propertyPathWithoutRootRecord, isMySpeech, isSelectable, name, timestamp, message, options)" th:remove="tag">
		<!--/* そもそも登録不可にしておくべきだが、messagesが空文字の場合は、表示が崩れるので半角空白を入れておく */-->
		<div th:classappend="'balloon_' + ${isMySpeech ? 'r' : 'l'}" th:with="message=${message == null || message == '' ? '&nbsp;' : message}">
			<div class="faceicon" th:if="${!isMySpeech}">
				<img th:src="@{/images/speech-balloon-account-icon.png}" alt="" />
			</div>
			<div>
				<div class="name" th:if="${!isMySpeech}" th:text="${name}"></div>
				<div th:classappend="${'says' + (isSelectable ? '-selectable' : '')}" th:id="${propertyPathWithoutRootRecord}"></div>
				<div class="name mt-1" th:style="${'font-size: 60%; ' + (isMySpeech ? '' : 'display: flex; align-items: flex-end;')}">
				<span th:style="${isMySpeech ? 'margin-left: auto;' : ''}" th:text="${timestamp}"></span>
			</div>
			<input type="hidden" th:id="${propertyPathWithoutRootRecord + '_hidden'}" th:value="${message}" />
			<script type="text/javascript">
				document.getElementById('[[${propertyPathWithoutRootRecord}]]').innerText = document.getElementById('[[${propertyPathWithoutRootRecord}]]' + '_hidden').value;
			</script>
		</div>
	</div>
	
</body>
</html>
